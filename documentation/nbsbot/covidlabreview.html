<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 9.0.1" />
    <title>nbsbot.covidlabreview API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2264%22%20height%3D%2264%22%20viewBox%3D%2244.5%202.5%2015%2015%22%3E%3Cpath%20d%3D%22M49.351%2021.041c-.233-.721-.546-2.408-.772-4.076-.042-.09-.067-.187-.046-.288-.166-1.347-.277-2.625-.241-3.351-1.378-1.008-2.271-2.586-2.271-4.362%200-.976.272-1.935.788-2.774.057-.094.122-.18.184-.268-.033-.167-.052-.339-.052-.516%200-1.477%201.202-2.679%202.679-2.679.791%200%201.496.352%201.987.9a6.3%206.3%200%200%201%201.001.029c.492-.564%201.207-.929%202.012-.929%201.477%200%202.679%201.202%202.679%202.679a2.65%202.65%200%200%201-.269%201.148c.383.747.595%201.572.595%202.41%200%202.311-1.507%204.29-3.635%205.107.037.699.147%202.27.423%203.294l.137.461c.156%202.136-4.612%205.166-5.199%203.215zm.127-4.919a4.78%204.78%200%200%200%20.775-.584c-.172-.115-.505-.254-.88-.378zm.331%202.302l.828-.502c-.202-.143-.576-.328-.984-.49zm.45%202.157l.701-.403c-.214-.115-.536-.249-.891-.376l.19.779zM49.13%204.141c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm.735-.389a1.15%201.15%200%200%201%20.314.783%201.16%201.16%200%200%201-1.162%201.162c-.457%200-.842-.27-1.032-.653-.026.117-.042.238-.042.362a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.843-.626-1.535-1.436-1.654zm3.076%201.654a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.037-.009-.072-.011-.109-.21.3-.541.508-.935.508a1.16%201.16%200%200%201-1.162-1.162%201.14%201.14%200%200%201%20.474-.912c-.015%200-.03-.005-.045-.005-.926.001-1.679.754-1.679%201.68zm1.861-1.265c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm1.823%204.823c0-.52-.103-1.035-.288-1.52-.466.394-1.06.64-1.717.64-1.144%200-2.116-.725-2.499-1.738-.383%201.012-1.355%201.738-2.499%201.738-.867%200-1.631-.421-2.121-1.062-.307.605-.478%201.267-.478%201.942%200%202.486%202.153%204.51%204.801%204.51s4.801-2.023%204.801-4.51zm-3.032%209.156l-.146-.492c-.276-1.02-.395-2.457-.444-3.268a6.11%206.11%200%200%201-1.18.115%206.01%206.01%200%200%201-2.536-.562l.006.175c.802.215%201.848.612%202.021%201.25.079.295-.021.601-.274.837l-.598.501c.667.304%201.243.698%201.311%201.179.02.144.022.507-.393.787l-.564.365c1.285.521%201.361.96%201.381%201.126.018.142.011.496-.427.746l-.854.489c.064-1.19%201.985-2.585%202.697-3.248zM49.34%209.925c0-.667%201-.667%201%200%200%20.653.818%201.205%201.787%201.205s1.787-.552%201.787-1.205c0-.667%201-.667%201%200%200%201.216-1.25%202.205-2.787%202.205s-2.787-.989-2.787-2.205zm-.887-7.633c-.093.077-.205.114-.317.114a.5.5%200%200%201-.318-.886L49.183.397a.5.5%200%200%201%20.703.068.5.5%200%200%201-.069.703zm7.661-.065c-.086%200-.173-.022-.253-.068l-1.523-.893c-.575-.337-.069-1.2.506-.863l1.523.892a.5.5%200%200%201%20.179.685c-.094.158-.261.247-.432.247z%22%20fill%3D%22%233bb300%22/%3E%3C/svg%3E"/>


<style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
<style>/*! pygments syntax highlighting */pre{line-height:125%;}td.linenos pre{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}span.linenos{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}td.linenos pre.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}span.linenos.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}.pdoc .hll{background-color:#ffffcc}.pdoc{background:#f8f8f8;}.pdoc .c{color:#408080; font-style:italic}.pdoc .err{border:1px solid #FF0000}.pdoc .k{color:#008000; font-weight:bold}.pdoc .o{color:#666666}.pdoc .ch{color:#408080; font-style:italic}.pdoc .cm{color:#408080; font-style:italic}.pdoc .cp{color:#BC7A00}.pdoc .cpf{color:#408080; font-style:italic}.pdoc .c1{color:#408080; font-style:italic}.pdoc .cs{color:#408080; font-style:italic}.pdoc .gd{color:#A00000}.pdoc .ge{font-style:italic}.pdoc .gr{color:#FF0000}.pdoc .gh{color:#000080; font-weight:bold}.pdoc .gi{color:#00A000}.pdoc .go{color:#888888}.pdoc .gp{color:#000080; font-weight:bold}.pdoc .gs{font-weight:bold}.pdoc .gu{color:#800080; font-weight:bold}.pdoc .gt{color:#0044DD}.pdoc .kc{color:#008000; font-weight:bold}.pdoc .kd{color:#008000; font-weight:bold}.pdoc .kn{color:#008000; font-weight:bold}.pdoc .kp{color:#008000}.pdoc .kr{color:#008000; font-weight:bold}.pdoc .kt{color:#B00040}.pdoc .m{color:#666666}.pdoc .s{color:#BA2121}.pdoc .na{color:#7D9029}.pdoc .nb{color:#008000}.pdoc .nc{color:#0000FF; font-weight:bold}.pdoc .no{color:#880000}.pdoc .nd{color:#AA22FF}.pdoc .ni{color:#999999; font-weight:bold}.pdoc .ne{color:#D2413A; font-weight:bold}.pdoc .nf{color:#0000FF}.pdoc .nl{color:#A0A000}.pdoc .nn{color:#0000FF; font-weight:bold}.pdoc .nt{color:#008000; font-weight:bold}.pdoc .nv{color:#19177C}.pdoc .ow{color:#AA22FF; font-weight:bold}.pdoc .w{color:#bbbbbb}.pdoc .mb{color:#666666}.pdoc .mf{color:#666666}.pdoc .mh{color:#666666}.pdoc .mi{color:#666666}.pdoc .mo{color:#666666}.pdoc .sa{color:#BA2121}.pdoc .sb{color:#BA2121}.pdoc .sc{color:#BA2121}.pdoc .dl{color:#BA2121}.pdoc .sd{color:#BA2121; font-style:italic}.pdoc .s2{color:#BA2121}.pdoc .se{color:#BB6622; font-weight:bold}.pdoc .sh{color:#BA2121}.pdoc .si{color:#BB6688; font-weight:bold}.pdoc .sx{color:#008000}.pdoc .sr{color:#BB6688}.pdoc .s1{color:#BA2121}.pdoc .ss{color:#19177C}.pdoc .bp{color:#008000}.pdoc .fm{color:#0000FF}.pdoc .vc{color:#19177C}.pdoc .vg{color:#19177C}.pdoc .vi{color:#19177C}.pdoc .vm{color:#19177C}.pdoc .il{color:#666666}</style>
<style>/*! pdoc */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f7f7f7;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}body{background-color:var(--pdoc-background);}html, body{width:100%;height:100%;}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:1.75rem;--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc li{display:block;margin:0;padding:.2rem 0 .2rem var(--indent);transition:all 100ms;}nav.pdoc > div > ul > li{padding-left:0;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}html, main{scroll-behavior:smooth;}.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{background-color:var(--code);border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;}.pdoc details > summary:focus{outline:0;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc > section:first-of-type > .docstring{margin-bottom:2.5rem;}.pdoc .docstring pre{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
</head>
<body>        <nav class="pdoc">
            <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
            <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
            <div>
                        <a class="pdoc-button module-list-button" href="../nbsbot.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                            &nbsp;nbsbot</a>


                        <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                               pattern=".+" required>



                    <h2>API Documentation</h2>
                        <ul class="memberlist">
            <li>
                    <a class="class" href="#COVIDlabreview">COVIDlabreview</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#COVIDlabreview.__init__">COVIDlabreview</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.reset">reset</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.get_db_connection_info">get_db_connection_info</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.get_patient_table">get_patient_table</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.get_unassigned_covid_labs">get_unassigned_covid_labs</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.select_counties">select_counties</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.select_min_delay">select_min_delay</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.get_age_range">get_age_range</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.select_aoe_filters">select_aoe_filters</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.check_for_possible_merges">check_for_possible_merges</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.check_patient_hospitalization_status">check_patient_hospitalization_status</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.check_for_existing_investigation">check_for_existing_investigation</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.create_investigation">create_investigation</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.associate_lab_with_investigation">associate_lab_with_investigation</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.query_immpact">query_immpact</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.id_covid_vaccinations">id_covid_vaccinations</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.import_covid_vaccinations">import_covid_vaccinations</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.determine_vaccination_status">determine_vaccination_status</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.read_street">read_street</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.read_city">read_city</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.read_zip">read_zip</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.write_zip">write_zip</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.read_county">read_county</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.write_county">write_county</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.read_address">read_address</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_state">set_state</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_country">set_country</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.check_ethnicity">check_ethnicity</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.clear_ambiguous_race_answers">clear_ambiguous_race_answers</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.check_race">check_race</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.read_demographic_address">read_demographic_address</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.write_demographic_address">write_demographic_address</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.read_demographic_race">read_demographic_race</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.write_demographic_race">write_demographic_race</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.read_demographic_ethnicity">read_demographic_ethnicity</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.write_demographic_ethnicity">write_demographic_ethnicity</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_investigation_start_date">set_investigation_start_date</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_investigation_status_closed">set_investigation_status_closed</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_state_case_id">set_state_case_id</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.read_investigation_id">read_investigation_id</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_county_and_state_report_dates">set_county_and_state_report_dates</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.update_report_date">update_report_date</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_performing_lab">set_performing_lab</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_earliest_positive_collection_date">set_earliest_positive_collection_date</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_case_status">set_case_status</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.review_case_status">review_case_status</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.update_aoe">update_aoe</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.update_case_info_aoes">update_case_info_aoes</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.update_pregnant_aoe">update_pregnant_aoe</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.update_symptom_aoe">update_symptom_aoe</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_confirmation_date">set_confirmation_date</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_closed_date">set_closed_date</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_immpact_query_to_yes">set_immpact_query_to_yes</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_vaccination_fields">set_vaccination_fields</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_lab_testing_performed">set_lab_testing_performed</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.set_mmwr">set_mmwr</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.check_jurisdiction">check_jurisdiction</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.create_notification">create_notification</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.send_bad_address_email">send_bad_address_email</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.send_failed_query_email">send_failed_query_email</a>
                        </li>
                        <li>
                                <a class="function" href="#COVIDlabreview.pause_for_database">pause_for_database</a>
                        </li>
                </ul>

            </li>
    </ul>



                    <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
                        built with <span class="visually-hidden">pdoc</span><img
                            alt="pdoc logo"
                            src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
                    </a>
            </div>
        </nav>
    <main class="pdoc">
            <section>
                    <h1 class="modulename">
<a href="./../nbsbot.html">nbsbot</a><wbr>.covidlabreview    </h1>

                
                        <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">nbsdriver</span> <span class="kn">import</span> <span class="n">NBSdriver</span>
<span class="kn">import</span> <span class="nn">configparser</span>
<span class="kn">import</span> <span class="nn">pyodbc</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">epiweeks</span> <span class="kn">import</span> <span class="n">Week</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">ElementNotInteractableException</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="k">class</span> <span class="nc">COVIDlabreview</span><span class="p">(</span><span class="n">NBSdriver</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A class inherits all basic NBS functionality from NBSdriver and adds</span>
<span class="sd">    methods for reviewing unassigned COVID labs.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">production</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">COVIDlabreview</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">production</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_main_window_handle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_address_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failed_immpact_query_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unambigous_races</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;American Indian or Alaska Native&#39;</span>
                                  <span class="p">,</span><span class="s1">&#39;Asian&#39;</span>
                                  <span class="p">,</span><span class="s1">&#39;Black or African American&#39;</span>
                                  <span class="p">,</span><span class="s1">&#39;Native Hawaiian or Other Pacific Islander&#39;</span>
                                  <span class="p">,</span><span class="s1">&#39;White&#39;</span><span class="p">]</span>
        <span class="c1"># The xpaths are set here because they are required by multiple methods. This creates one maintenance point in the event of future change.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[2]/td[2]/input&#39;</span>
                                      <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[3]/td[2]/input&#39;</span>
                                      <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[4]/td[2]/input&#39;</span>
                                      <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[5]/td[2]/input&#39;</span>
                                      <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[6]/td[2]/input&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[1]/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">street_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;DEM159&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;DEM161&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;DEM163&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">county_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_15&quot;]/tbody/tr[6]/td[2]/input&#39;</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clear values of attributes assigned during case investigation review.</span>
<span class="sd">        To be used on initialization and between case reviews. &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">now_str</span> <span class="o">=</span> <span class="n">today</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address_complete</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_doses_prior_to_onset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_dose_date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">street</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">county</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_code</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">demo_race</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">demo_ethnicity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">investigation_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_window_handle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiple_possible_patients_in_immpact</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">get_db_connection_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read information required to connect to the NBS database.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;driver&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;server&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_rdb_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;rdb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_odse_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;odse&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_unassigned_covid_lab_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;unassigned_covid_lab_table&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_patient_list_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;patient_list_view&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_patient_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Execute a view in the nbs_odse database to return all patients in</span>
<span class="sd">        NBS including firt name, last name, birth date, and parent id. This data</span>
<span class="sd">        is then stored in a DataFrame for future use.&quot;&quot;&quot;</span>

        <span class="c1"># Connect to database</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RETRIEVE NBS PATIENT LIST:</span><span class="se">\n</span><span class="s1">Connecting to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_odse_name</span><span class="si">}</span><span class="s1"> database...&#39;</span><span class="p">)</span>
        <span class="n">Connection</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;Driver={&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_driver</span> <span class="o">+</span> <span class="s2">&quot;};&quot;</span>
                              <span class="sa">fr</span><span class="s2">&quot;Server=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_server</span><span class="si">}</span><span class="s2">;&quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;Database=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_odse_name</span><span class="si">}</span><span class="s2">;&quot;</span>
                              <span class="s2">&quot;Trusted_Connection=yes;&quot;</span><span class="p">)</span>
        <span class="c1"># Execute query and close connection</span>
        <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Connected to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_odse_name</span><span class="si">}</span><span class="s1">. Executing query...&#39;</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT PERSON_PARENT_UID, UPPER(FIRST_NM) AS FIRST_NM, UPPER(LAST_NM) AS LAST_NM, BIRTH_DT FROM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_patient_list_view</span><span class="si">}</span><span class="s2"> WHERE (FIRST_NM IS NOT NULL) AND (LAST_NM IS NOT NULL) AND (BIRTH_DT IS NOT NULL) AND (RECORD_STATUS_CD = &#39;ACTIVE&#39;)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">Connection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">Connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Data recieved and database connection closed.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_unassigned_covid_labs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Connect to the analyis NBS database and execute a query to return a</span>
<span class="sd">        list of all unassociated labs along with the data required to create</span>
<span class="sd">        investigations for them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_counties</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_min_delay</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_age_range</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_aoe_filters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_db_connection_info</span><span class="p">()</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lab_Local_ID&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;CAST(Lab_Rpt_Received_By_PH_Dt AS DATE) AS Lab_Rpt_Received_By_PH_Dt&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;CAST(Specimen_Coll_DT AS DATE) AS Specimen_Coll_DT&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Perform_Facility_Name&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;UPPER(First_Name) AS First_Name&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;UPPER(Middle_Name) AS Middle_Name&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;UPPER(Last_Name) AS Last_Name&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Patient_Local_ID&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Current_Sex_Cd&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;CAST(Birth_Dt AS DATE) AS Birth_Dt&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Patient_Race_Calc&#39;</span>
                        <span class="p">,</span><span class="s2">&quot;CASE WHEN Patient_Ethnicity = &#39;2186-5&#39; THEN &#39;Hispanic or Latino&#39; &quot;</span>
                        <span class="s2">&quot;WHEN Patient_Ethnicity = &#39;2135-2&#39; THEN &#39;Not Hispanic or Latino&#39; &quot;</span>
                        <span class="s2">&quot;ELSE &#39;Unknown&#39; END AS Patient_Ethnicity&quot;</span>
                        <span class="p">,</span><span class="s1">&#39;Patient_Death_Ind&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Patient_Death_Date&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Phone_Number&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Address_One&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Address_Two&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;City&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;State&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;County_Desc&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Jurisdiction_Nm&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;EMPLOYED_IN_HEALTHCARE&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;HOSPITALIZED&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;PATIENT_AGE&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;PREGNANT&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;RESIDENT_CONGREGATE_SETTING&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;SYMPTOMATIC_FOR_DISEASE&#39;</span>
                        <span class="p">,</span><span class="s2">&quot;CASE WHEN ILLNESS_ONSET_DATE LIKE &#39;[0-9][0-9][/-][0-9][0-9][/-][0-9][0-9][0-9][0-9]&#39; THEN CAST(ILLNESS_ONSET_DATE AS DATE) &quot;</span>
		                <span class="s2">&quot;WHEN ILLNESS_ONSET_DATE LIKE &#39;[0-9][0-9][0-9][0-9][/-][0-9][0-9][/-][0-9][0-9]&#39; THEN CAST(ILLNESS_ONSET_DATE AS DATE) &quot;</span>
		                <span class="s2">&quot;WHEN ILLNESS_ONSET_DATE LIKE &#39;[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]&#39; THEN CAST(ILLNESS_ONSET_DATE AS DATE) &quot;</span>
		                <span class="s2">&quot;ELSE NULL END AS ILLNESS_ONSET_DATE&quot;</span>
                        <span class="p">,</span><span class="s1">&#39;FIRST_RESPONDER&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;TestType&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;DATEDIFF(DAY, CAST(Specimen_Coll_DT AS DATE), GETDATE()) AS review_delay&#39;</span>
                        <span class="p">)</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
        <span class="c1"># If a lab is not positive an investigation should not be created for it.</span>
        <span class="c1"># All cases with AOEs indicating hospitalization, or death should be assigned out for investigation. These cases should not be opened and closed.</span>
        <span class="n">where</span> <span class="o">=</span> <span class="s2">&quot;WHERE (Result_Category = &#39;Positive&#39;) AND (State = &#39;ME&#39;) AND (TestType IN (&#39;PCR&#39;, &#39;Antigen&#39;)) AND (HOSPITALIZED IS NULL OR UPPER(HOSPITALIZED) NOT LIKE &#39;Y%&#39;) AND (ICU IS NULL OR UPPER(ICU) NOT LIKE &#39;Y%&#39;) AND (Patient_Death_Ind IS NULL OR UPPER(Patient_Death_Ind) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; AND (DATEDIFF(DAY, Lab_Rpt_Received_By_PH_Dt ,GETDATE())) &gt;= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; AND (DATEDIFF(DAY, CAST(Birth_Dt AS DATE), CAST(Specimen_Coll_DT AS DATE))/365.25 &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_age</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; AND (DATEDIFF(DAY, CAST(Birth_Dt AS DATE), CAST(Specimen_Coll_DT AS DATE))/365.25 &lt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_age</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cong_aoe_lab</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="s2">&quot; AND (RESIDENT_CONGREGATE_SETTING IS NULL OR UPPER(RESIDENT_CONGREGATE_SETTING) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hcw_aoe_lab</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="s2">&quot; AND (EMPLOYED_IN_HEALTHCARE IS NULL OR UPPER(EMPLOYED_IN_HEALTHCARE) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">responder_aoe_lab</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="s2">&quot; AND (FIRST_RESPONDER IS NULL OR UPPER(FIRST_RESPONDER) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pregnant_aoe_lab</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="s2">&quot; AND (PREGNANT IS NULL OR UPPER(PREGNANT) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="s1">&#39;ORDER BY Lab_Rpt_Received_By_PH_Dt&#39;</span>
        <span class="c1"># Construct Query</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;SELECT&#39;</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="s1">&#39;FROM&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbs_unassigned_covid_lab_table</span><span class="p">,</span> <span class="n">where</span><span class="p">,</span> <span class="n">order_by</span><span class="p">]</span> <span class="p">)</span>
        <span class="c1"># Connect to database</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RETRIEVE UNASSOCIATED LAB LIST:</span><span class="se">\n</span><span class="s1">Connecting to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_rdb_name</span><span class="si">}</span><span class="s1"> database...&#39;</span><span class="p">)</span>
        <span class="n">Connection</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;Driver={&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_driver</span> <span class="o">+</span> <span class="s2">&quot;};&quot;</span>
                              <span class="sa">fr</span><span class="s2">&quot;Server=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_server</span><span class="si">}</span><span class="s2">;&quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;Database=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_rdb_name</span><span class="si">}</span><span class="s2">;&quot;</span>
                              <span class="s2">&quot;Trusted_Connection=yes;&quot;</span><span class="p">)</span>
        <span class="c1"># Execute query and close connection</span>
        <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Connected to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_rdb_name</span><span class="si">}</span><span class="s1">. Executing query...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">Connection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">County_Desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">County_Desc</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; County&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">Connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">Jurisdiction_Nm</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">Patient_Local_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">Patient_Local_ID</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clean_patient_id</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Data recieved and database connection closed.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">select_counties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A method to prompt the user to specify which counties unassociated labs should be review from.&quot;&quot;&quot;</span>
        <span class="n">maine_counties</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Androscoggin&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Aroostook&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Cumberland&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Franklin&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Hancock&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Kennebec&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Knox&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Lincoln&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Oxford&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Penobscot&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Piscataquis&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Sagadahoc&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Somerset&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Waldo&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Washington&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;York&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">county</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">maine_counties</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">county</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counties</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;COUNTY SLECTION:</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Choose the counties from which to review unassocated labs.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Make your selection by entering the row numbers of the desired counties separated by commas.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;For example, to select Cumberland and York counties enter &quot;2,15&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Press enter to skip this step and review unassociated labs from all counties.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">counties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">counties</span> <span class="o">=</span> <span class="p">[</span><span class="n">maine_counties</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="p">)]</span><span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">select_min_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A method to prompt the user to specify the minimum delay in reviewing unassociated labs.</span>
<span class="sd">        If 3 is select then NBSbot will only review unassocated labs that were reported 3 or more days ago.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET MINIMUM REVIEW DELAY:</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Enter the minimum integer number of days between the date a lab was collected and today that unassociated labs should be reviewed from.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Enter &quot;0&quot; or simply press enter to skip this step and review all unassociated labs regardless of review delay.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_age_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prompt user to provide the minimum and maximum patient age of unassociated labs to be opened and closed.&quot;&quot;&quot;</span>
        <span class="n">default_min</span> <span class="o">=</span> <span class="s1">&#39;-5&#39;</span>
        <span class="n">default_max</span> <span class="o">=</span> <span class="s1">&#39;150&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_age</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET MINIMUM AGE:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;Enter the minimum age in years that cases should be opened and closed for.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;If no age is specified the minimum value will be set to </span><span class="si">{</span><span class="n">default_min</span><span class="si">}</span><span class="s1"> years.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_age</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET MAXIMUM AGE:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;Enter the maximum age in years that cases should be opened and closed for.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;If no age is specified the maximum value will be set to </span><span class="si">{</span><span class="n">default_max</span><span class="si">}</span><span class="s1"> years.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_age</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_age</span> <span class="o">=</span> <span class="n">default_min</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_age</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_age</span> <span class="o">=</span> <span class="n">default_max</span>

    <span class="k">def</span> <span class="nf">select_aoe_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prompt user to decide if they would like to filter out unassociated las on the basis of affirmative AOE respones.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cong_aoe_lab</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET CONGREGATE AOE FILTER:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;0: Review unassociated labs with an affirmative congregate setting AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;1: DO NOT review unassociated labs with an affirmative congregate setting AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;To review labs with an affirmative congregte setting AOE response enter &quot;0&quot; or simply press enter.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;If you would NOT like to review unasocciated labs with an affiramtive congregate setting AOE enter &quot;1&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hcw_aoe_lab</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET HEALTHCARE WORKER AOE FILTER:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;0: Review unassociated labs with an affirmative heathcare worker AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;1: DO NOT review unassociated labs with an affirmative healthcare worker AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;To review labs with an affirmative healthcare worker AOE response enter &quot;0&quot; or simply press enter.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;If you would NOT like to review unasocciated labs with an affiramtive healthcare worker AOE enter &quot;1&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">responder_aoe_lab</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET FIRST RESPONDER AOE FILTER:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;0: Review unassociated labs with an affirmative first responder AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;1: DO NOT review unassociated labs with an affirmative frist responder AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;To review labs with an affirmative first responder AOE response enter &quot;0&quot; or simply press enter.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;If you would NOT like to review unasocciated labs with an affiramtive first responder AOE enter &quot;1&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pregnant_aoe_lab</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET PREGNANT AOE FILTER:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;0: Review unassociated labs with an affirmative congregate setting AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;1: DO NOT  Review unassociated labs with an affirmative congregate setting AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;To review labs with an affirmative congregte setting AOE response enter &quot;0&quot; or simply press enter.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;If you would NOT like to review unasocciated labs with an affiramtive congregate setting AOE enter &quot;1&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_for_possible_merges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">lname</span><span class="p">,</span> <span class="n">dob</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Given a patient&#39;s first name, last name, and dob search for possible</span>
<span class="sd">        matches amoung all patients in NBS.&quot;&quot;&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">FIRST_NM</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">fname</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">LAST_NM</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">lname</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">BIRTH_DT</span> <span class="o">==</span> <span class="n">dob</span><span class="p">)]</span>
        <span class="n">unique_profiles</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">PERSON_PARENT_UID</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_profiles</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">possible_merges</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">possible_merges</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">possible_merges</span>

    <span class="k">def</span> <span class="nf">check_patient_hospitalization_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check Patient Status at Specimen Collection from inside a lab report.</span>
<span class="sd">        Occasionally there are cases that indicate a status of &#39;inpatient&#39; without an AOE inidicating a hospitalization.</span>
<span class="sd">        In this case the bot will not open and closed a case, but instead leave the lab for human review.&quot;&quot;&quot;</span>
        <span class="n">patient_status_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_LAB330&quot;]&#39;</span>
        <span class="n">patient_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">patient_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">patient_status</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;HOSPITALIZED&#39;</span><span class="p">,</span> <span class="s1">&#39;INPATIENT&#39;</span><span class="p">]:</span>
            <span class="n">possible_hospitalization</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">possible_hospitalization</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">possible_hospitalization</span>

    <span class="k">def</span> <span class="nf">check_for_existing_investigation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Review the Investigations table in the Events tab of a patient profile</span>
<span class="sd">        to determine if the case already has an existing investigation. &quot;&quot;&quot;</span>
        <span class="n">investigation_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_investigation_table</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">investigation_table</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">investigation_table</span><span class="p">[</span><span class="s1">&#39;days_prior&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">investigation_table</span><span class="p">[</span><span class="s1">&#39;Start Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">collection_date</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">date</span><span class="p">())</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
            <span class="n">existing_investigations</span> <span class="o">=</span> <span class="n">investigation_table</span><span class="p">[(</span><span class="n">investigation_table</span><span class="o">.</span><span class="n">days_prior</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">)</span>
                                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">investigation_table</span><span class="o">.</span><span class="n">days_prior</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">35</span><span class="p">)</span>
                                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">investigation_table</span><span class="o">.</span><span class="n">Condition</span> <span class="o">==</span> <span class="s1">&#39;2019 Novel Coronavirus (2019-nCoV)&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_investigations</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span> <span class="o">=</span> <span class="n">existing_investigations</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">inv_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_investigations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">existing_investigations</span><span class="p">[</span><span class="s1">&#39;Case Status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Not a Case&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">existing_not_a_case</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">existing_not_a_case</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">inv_found</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">existing_not_a_case</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inv_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">existing_not_a_case</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">inv_found</span><span class="p">,</span> <span class="n">existing_not_a_case</span>

    <span class="k">def</span> <span class="nf">create_investigation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new investigation from within a lab report when one does not already exist .&quot;&quot;&quot;</span>
        <span class="n">create_investigation_button_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;doc3&quot;]/div[2]/table/tbody/tr/td[2]/input[1]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">create_investigation_button_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">create_investigation_button_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">select_condition_field_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ccd_ac_table&quot;]/tbody/tr[1]/td/input&#39;</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="s1">&#39;2019 Novel Coronavirus (2019-nCoV)&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">select_condition_field_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">select_condition_field_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
        <span class="n">submit_button_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/table/tbody/tr/td/table/tbody/tr[3]/td/table/thead/tr[2]/td/div/table/tbody/tr/td/table/tbody/tr/td[4]/table[1]/tbody/tr[1]/td/input&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_button_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_button_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">associate_lab_with_investigation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Associate a lab with an existing investigation when one for the case has already been started.&quot;&quot;&quot;</span>
        <span class="n">lab_report_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;events1&quot;]&#39;</span>
        <span class="n">lab_report_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">lab_report_table_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lab_report_table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lab_row_index</span> <span class="o">=</span> <span class="n">lab_report_table</span><span class="p">[</span><span class="n">lab_report_table</span><span class="p">[</span><span class="s1">&#39;Event ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">lab_id</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lab_row_index</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lab_row_index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">lab_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/html/body/div[2]/div/form/div/div/div/table[2]/tbody/tr/td/table/tbody/tr[</span><span class="si">{</span><span class="n">lab_row_index</span><span class="si">}</span><span class="s1">]/td[1]/div/input&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">lab_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span><span class="n">lab_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">query_immpact</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Click the query registry button, submit the query to immpact, and read the results into a DataFrame.&quot;&quot;&quot;</span>
        <span class="n">query_registry_button</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;events3&quot;]/tbody/tr/td/div/input[1]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">query_registry_button</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">query_registry_button</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
        <span class="n">submit_query</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;doc4&quot;]/div[2]/input[1]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_query</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
        <span class="n">results_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;section1&quot;]/div/table&#39;</span>
        <span class="n">results_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">results_table_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results_table</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">results_table</span><span class="p">[</span><span class="s1">&#39;Patient Name&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Nothing found to display.&#39;</span><span class="p">):</span>
            <span class="n">record_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;parent&quot;]/tbody/tr/td[1]/a&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">record_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
            <span class="n">vax_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;section1&quot;]/div/table[2]&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">vax_table_path</span><span class="p">)</span>
            <span class="n">good_query</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">good_query</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Immpact returned more than one patient as a possible, or found no matching patients. Unable to proceed with the automated query.&#39;</span><span class="p">)</span>
            <span class="n">cancel_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/form/div[2]/div/div[1]/input&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">cancel_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">alert</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results_table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiple_possible_patients_in_immpact</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">good_query</span>

    <span class="k">def</span> <span class="nf">id_covid_vaccinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Identify COVID vaccines by their specific brand.&quot;&quot;&quot;</span>
        <span class="n">covid_vax_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pfizer&#39;</span><span class="p">:</span><span class="s1">&#39;COVID-19, mRNA, LNP-S, PF, 30 mcg/0.3 mL dose&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Moderna&#39;</span><span class="p">:</span><span class="s1">&#39;COVID-19, mRNA, LNP-S, PF, 100 mcg/ 0.5 mL dose&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;JJ&#39;</span><span class="p">:</span><span class="s1">&#39;COVID-19 vaccine, vector-nr, rS-Ad26, PF, 0.5 mL&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Pfizer_5to12&#39;</span><span class="p">:</span> <span class="s1">&#39;Tris-sucrose formula, 10 mcg/0.2 mL for ages 5 yrs to &lt; 12 yrs&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">covid_vax_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="p">[</span><span class="s1">&#39;Vaccine Administered&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">covid_vax_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">Pfizer</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">Moderna</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">JJ</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">Pfizer_5to12</span><span class="p">]</span>
        <span class="c1">#self.covid_vaccinations[&#39;Date Administered&#39;] = pd.to_datetime(self.covid_vaccinations[&#39;Date Administered&#39;])</span>
        <span class="c1">#self.covid_vaccinations[&#39;Date Administered&#39;] = self.covid_vaccinations[&#39;Date Administered&#39;].dt.date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">(),</span> <span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>

    <span class="k">def</span> <span class="nf">import_covid_vaccinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Select all COVID vaccinations in the list returned by Immpact and import them.&quot;&quot;&quot;</span>
        <span class="n">covid_vax_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">num_covid_vaccinations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">covid_vax_indexes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_covid_vaccinations</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">covid_vax_indexes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">select_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/form/div[2]/div/div[4]/div/table[2]/tbody/tr/td/table/tbody/tr/td[1]/input&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">select_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">covid_vax_indexes</span><span class="p">:</span>
                    <span class="n">select_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/html/body/form/div[2]/div/div[4]/div/table[2]/tbody/tr/td/table/tbody/tr[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">]/td[1]/input&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">select_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="n">import_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/form/div[2]/div/div[1]/input[1]&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">import_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">alert</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_handles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_handles</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">handle</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window_handle</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window_handle</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">failed_immpact_query_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cancel_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/form/div[2]/div/div[1]/input[2]&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">cancel_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">alert</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">determine_vaccination_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Determine vaccination status at time of illness and other required vaccination data points.&quot;&quot;&quot;</span>
        <span class="n">covid_vaccinations_prior_to_onset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">collection_date</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_doses_prior_to_onset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">covid_vaccinations_prior_to_onset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_dose_date</span> <span class="o">=</span> <span class="n">covid_vaccinations_prior_to_onset</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">complete_vaccinations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">collection_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">))]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">Pfizer</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">Moderna</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">JJ</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">Pfizer_5to12</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_vaccinated</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">read_street</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read the current street address.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">street</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">street_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_city</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the current city/town.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the current zip code. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write zip code. Intended for use after looking up a missing zip code with zip_code_lookup().&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zip_code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_county</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the current county. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">county</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">county_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_county</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write county. Intended for use after looking up a missing missing count with county_lookup().&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">county_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">county</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read parts of the patient address except for state and country.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_street</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_city</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_zip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_county</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set state value in patient address.&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_15&quot;]/tbody/tr[4]/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_country</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">country</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set country value in patient address.&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_15&quot;]/tbody/tr[7]/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">country</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_ethnicity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if ethnicity is completed and if not set the values to unknown.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear_ambiguous_race_answers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Ensure all ambiguous race answers (refused to answer, not answered, and unknown) are not selected.&quot;&quot;&quot;</span>
        <span class="n">ambiguous_answer_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[8]/td[2]/input&#39;</span>
                                 <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[9]/td[2]/input&#39;</span>
                                 <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[10]/td[2]/input&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">ambiguous_answer_paths</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unselect_checkbox</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_race</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Review current race value. If any combination of non-ambiguous options</span>
<span class="sd">        are selection make sure all other choice are not selected. Accept &quot;other&quot;</span>
<span class="sd">        only when no unambigious answer is present. When race is not clearly</span>
<span class="sd">        defined or other set value to unknown.&quot;&quot;&quot;</span>
        <span class="n">other_race_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[7]/td[2]/input&#39;</span>
        <span class="n">unknown_race_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[10]/td[2]/input&#39;</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race_paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">is_selected</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_ambiguous_race_answers</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unselect_checkbox</span><span class="p">(</span><span class="n">other_race_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">other_race_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_selected</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_checkbox</span><span class="p">(</span><span class="n">other_race_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">unknown_race_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">read_demographic_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read address table from the demographics tab of a patient profile and</span>
<span class="sd">        select the most recent address from within the last year that is consistent</span>
<span class="sd">        with all parts of the address reported in the current lab report.&quot;&quot;&quot;</span>
        <span class="n">address_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;patSearch8&quot;]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">address_table_path</span><span class="p">)))</span>
        <span class="n">address_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">address_table_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">address_table</span><span class="p">)</span> <span class="o">!=</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">address_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">address_table_path</span><span class="p">)</span>
        <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="p">[</span><span class="n">address_table</span><span class="p">[</span><span class="s1">&#39;As of&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="n">address_table</span><span class="p">[</span><span class="s1">&#39;As of&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">address_table</span><span class="p">[</span><span class="s1">&#39;As of&#39;</span><span class="p">],</span> <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y&quot;</span><span class="p">)</span>
        <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="p">[</span><span class="s1">&#39;As of&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">))]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">address_table</span><span class="o">.</span><span class="n">Zip</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">Zip</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="k">else</span> <span class="n">x</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">street</span><span class="p">:</span>
            <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="o">.</span><span class="n">Address</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">street</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="p">:</span>
            <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="o">.</span><span class="n">City</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
        <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="o">.</span><span class="n">State</span> <span class="o">==</span> <span class="s1">&#39;Maine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_code</span><span class="p">:</span>
            <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="o">.</span><span class="n">Zip</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">street</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">address_table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">write_demographic_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; After reading an address from the demographics tab, moving back into</span>
<span class="sd">        an investigation, and entering edit mode, write the data to the address</span>
<span class="sd">        fields.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">street_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span><span class="o">.</span><span class="n">Address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span><span class="o">.</span><span class="n">City</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span><span class="o">.</span><span class="n">Zip</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">county_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span><span class="o">.</span><span class="n">Address</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_demographic_race</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the race table in the demographics tab and select the most recent</span>
<span class="sd">        nonambigous value, if present.&quot;&quot;&quot;</span>
        <span class="n">race_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;patSearch14&quot;]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">race_table_path</span><span class="p">)))</span>
        <span class="n">race_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">race_table_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">race_table</span><span class="p">)</span> <span class="o">!=</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">race_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">race_table_path</span><span class="p">)</span>
        <span class="n">all_race_values</span> <span class="o">=</span> <span class="n">race_table</span><span class="o">.</span><span class="n">Race</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">unambiguous_race_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_race_values</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unambigous_races</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">unambiguous_race_values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">demo_race</span> <span class="o">=</span> <span class="n">unambiguous_race_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">write_demographic_race</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; After reading a race from the demographics tab, moving back into an</span>
<span class="sd">        investigation, and entering edit mode, write the data to the race field.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">race</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unambigous_races</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race_paths</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">race</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demo_race</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_checkbox</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_ambiguous_race_answers</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">read_demographic_ethnicity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the ethnicity table in the demographics tab and select the most</span>
<span class="sd">        recent non-unknown value, if present.&quot;&quot;&quot;</span>
        <span class="n">ethnicity_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS108&quot;]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">ethnicity_path</span><span class="p">)))</span>
        <span class="n">ethnicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">ethnicity_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ethnicity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Hispanic or Latino&#39;</span><span class="p">,</span> <span class="s1">&#39;Not Hispanic or Latino&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">demo_ethnicity</span> <span class="o">=</span> <span class="n">ethnicty</span>

    <span class="k">def</span> <span class="nf">write_demographic_ethnicity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; After reading an ethnicity from the demographics tab, moving back into an</span>
<span class="sd">        investigation, and entering edit mode, write the data to the ethnicity field.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_ethnicity</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_investigation_start_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set investigation start date to today.&quot;&quot;&quot;</span>
        <span class="n">start_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV147&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">start_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_investigation_status_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set investigation status to closed.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">incestigation_status_down_arrow</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_19&quot;]/tbody/tr[4]/td[2]/img&#39;</span>
            <span class="n">closed_option</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV109&quot;]/option[1]&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">incestigation_status_down_arrow</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">closed_option</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_investigation_status_closed</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_state_case_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the State Case ID to the NBS patient ID.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">state_case_id_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV173&quot;]&#39;</span>
            <span class="n">patient_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadPatientID</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">state_case_id_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_state_case_id</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">read_investigation_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; From within an investigation read the investigation id.&quot;&quot;&quot;</span>
        <span class="n">investigation_id_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/div/div/form/div[2]/div[1]/table[3]/tbody/tr[2]/td[1]/span[2]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">investigation_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">investigation_id_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_county_and_state_report_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_to_ph_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set Earliest Date Reported to County and Earliest Date Reported to</span>
<span class="sd">        State based on Lab_Rpt_Received_By_PH_Dt. This method may be used when</span>
<span class="sd">        creating new investigations or when associating additional labs with an</span>
<span class="sd">        existing investigation. In the case where there is an existing report</span>
<span class="sd">        date in the existing invesitigation it will only be replaced when the</span>
<span class="sd">        provided report date is earlier.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">report_date_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;//*[@id=&quot;INV120&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;//*[@id=&quot;INV121&quot;]&#39;</span><span class="p">]</span>
            <span class="n">report_to_ph_date_str</span> <span class="o">=</span> <span class="n">report_to_ph_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">report_date_paths</span><span class="p">:</span>
                <span class="n">current_report_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadDate</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current_report_date</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">report_to_ph_date</span> <span class="o">&lt;</span> <span class="n">current_report_date</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span> <span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">report_to_ph_date_str</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">report_to_ph_date_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_county_and_state_report_dates</span><span class="p">(</span><span class="n">report_to_ph_date</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_report_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_to_ph_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;When associating a lab with an existing investigation check to see if</span>
<span class="sd">        the new lab was reported prior to the report date currently assigned to</span>
<span class="sd">        the investigation. If so, replace it with the report date of the new lab.</span>
<span class="sd">        If not, do nothing.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">report_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV111&quot;]&#39;</span>
            <span class="n">current_report_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadDate</span><span class="p">(</span><span class="n">report_date_path</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="n">report_to_ph_date_str</span> <span class="o">=</span> <span class="n">report_to_ph_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current_report_date</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">report_to_ph_date</span> <span class="o">&lt;</span> <span class="n">current_report_date</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">report_date_path</span> <span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">report_date_path</span> <span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">report_to_ph_date_str</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">report_to_ph_date</span> <span class="o">=</span> <span class="n">report_to_ph_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">report_date_path</span> <span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">report_to_ph_date_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_report_date</span><span class="p">(</span><span class="n">report_to_ph_date</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_performing_lab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">performing_lab</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set performing laboratory name based on lab report.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">performing_lab</span><span class="p">:</span>
                <span class="n">performing_lab_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME6105&quot;]&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">performing_lab_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">performing_lab</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_performing_lab</span><span class="p">(</span><span class="n">performing_lab</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_earliest_positive_collection_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_collection_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read the earliest positive speciment collection date field. If there</span>
<span class="sd">        is a date present and it is prior to the collection of the current lab do</span>
<span class="sd">        nothing. In the event that the field is blank or the collection of the</span>
<span class="sd">        current lab is prior to the current value of the field, set the value to</span>
<span class="sd">        the collection date of the current lab. This additional check allows this</span>
<span class="sd">        method to be used when creating investigations or associating labs with</span>
<span class="sd">        existing investigations.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">collection_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS550&quot;]&#39;</span>
            <span class="n">lab_collection_date_str</span> <span class="o">=</span> <span class="n">lab_collection_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadDate</span><span class="p">(</span><span class="n">collection_date_path</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span> <span class="o">=</span> <span class="n">lab_collection_date</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">collection_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">collection_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">lab_collection_date_str</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lab_collection_date</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span> <span class="o">=</span> <span class="n">lab_collection_date</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">collection_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">collection_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">lab_collection_date_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_earliest_positive_collection_date</span><span class="p">(</span><span class="n">lab_collection_date</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_case_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set all three fields related to case status based on the provided status.&quot;&quot;&quot;</span>
        <span class="n">current_status_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_GA21015&quot;]/tbody/tr[3]/td[2]/input&#39;</span>
        <span class="n">probable_reason_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_GA21015&quot;]/tbody/tr[4]/td[2]/input&#39;</span>
        <span class="n">case_status_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_2&quot;]/tbody/tr[5]/td[2]/input&#39;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;Confirmed&#39;</span><span class="p">:</span>
            <span class="n">current_status</span> <span class="o">=</span> <span class="s1">&#39;Laboratory-confirmed case&#39;</span>
            <span class="n">probable_reason</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;Probable&#39;</span><span class="p">:</span>
            <span class="n">current_status</span> <span class="o">=</span> <span class="s1">&#39;Probable Case&#39;</span>
            <span class="n">probable_reason</span> <span class="o">=</span> <span class="s1">&#39;Meets Presump Lab and Clinical or Epi&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">current_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">current_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">current_status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">probable_reason_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">probable_reason_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">probable_reason</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">case_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">case_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">review_case_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Review current case status and current lab type. Then set case status</span>
<span class="sd">        accordingly. This method can be used for creating investigations or</span>
<span class="sd">        associating additional labs with existing investigations.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">case_status_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_2&quot;]/tbody/tr[5]/td[2]/input&#39;</span>
            <span class="n">current_case_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">case_status_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lab_type</span> <span class="o">==</span> <span class="s1">&#39;PCR&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_case_status</span><span class="p">(</span><span class="s1">&#39;Confirmed&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lab_type</span> <span class="o">==</span> <span class="s1">&#39;Antigen&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_case_status</span><span class="p">(</span><span class="s1">&#39;Probable&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">review_case_status</span><span class="p">(</span><span class="n">lab_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_aoe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">,</span> <span class="n">lab_aoe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update a specific AOE associated investigation field by considering</span>
<span class="sd">        its current value and the value in the current lab. An affirmative</span>
<span class="sd">        response in either the investigation or the lab takes precedence, followed</span>
<span class="sd">        by negative, unknown, and null responses respectively.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lab_aoe</span><span class="p">:</span>
                <span class="n">investigation_aoe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">aoe_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;No&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;No&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_aoe</span><span class="p">(</span><span class="n">aoe_path</span><span class="p">,</span> <span class="n">lab_aoe</span><span class="p">,</span> <span class="s1">&#39;case_info&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_case_info_aoes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hosp_aoe</span><span class="p">,</span> <span class="n">cong_aoe</span><span class="p">,</span> <span class="n">responder_aoe</span><span class="p">,</span> <span class="n">hcw_aoe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update every AOE on the Case Info tabe using the update_aoe() method.&quot;&quot;&quot;</span>
        <span class="n">aoe_dictionary</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_NBS_INV_GENV2_UI_3&quot;]/tbody/tr[1]/td[2]/input&#39;</span> <span class="p">:</span> <span class="n">hosp_aoe</span>
                         <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;ME59136&quot;]/tbody/tr[3]/td[2]/input&#39;</span> <span class="p">:</span> <span class="n">cong_aoe</span>
                         <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;ME59137&quot;]/tbody/tr[1]/td[2]/input&#39;</span> <span class="p">:</span> <span class="n">responder_aoe</span>
                         <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;UI_ME59106&quot;]/tbody/tr[1]/td[2]/input&#39;</span> <span class="p">:</span> <span class="n">hcw_aoe</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">aoe_path</span><span class="p">,</span> <span class="n">aoe_value</span> <span class="ow">in</span> <span class="n">aoe_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">aoe_value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_aoe</span><span class="p">(</span><span class="n">aoe_path</span><span class="p">,</span> <span class="n">aoe_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_pregnant_aoe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pregnant_aoe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update pregnancy status AOE on COVID tab.&quot;&quot;&quot;</span>
        <span class="n">lab_aoe</span> <span class="o">=</span> <span class="n">pregnant_aoe</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lab_aoe</span><span class="p">:</span>
                <span class="n">aoe_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME58100&quot;]/tbody/tr[1]/td[2]/input&#39;</span>
                <span class="n">investigation_aoe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">aoe_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;No&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;No&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">update_symptom_aoe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_symptom_aoe</span><span class="p">,</span> <span class="n">lab_onset_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update symptom status based on values in an investigation and values</span>
<span class="sd">        reported in the current lab.&quot;&quot;&quot;</span>
        <span class="n">symptom_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_GA21003&quot;]/tbody/tr[3]/td[2]/input&#39;</span>
        <span class="n">onset_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV137&quot;]&#39;</span>
        <span class="n">investigation_symptom_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">symptom_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lab_onset_date</span><span class="p">:</span>
            <span class="n">lab_symptom_aoe</span> <span class="o">=</span> <span class="s1">&#39;Yes&#39;</span>
        <span class="k">if</span> <span class="n">lab_symptom_aoe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">symptom_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">investigation_symptom_status</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_symptom_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">symptom_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_symptom_status</span> <span class="o">==</span> <span class="s1">&#39;No&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_symptom_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">symptom_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;No&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_symptom_status</span> <span class="o">==</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_symptom_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">symptom_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">investigation_symptom_status</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">:</span>
                <span class="n">investigation_onset_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadDate</span><span class="p">(</span><span class="n">onsed_date_path</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">investigation_onset_date</span> <span class="ow">and</span> <span class="n">lab_onset_date</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">lab_onset_date</span> <span class="o">&lt;</span> <span class="n">investigation_onset_date</span><span class="p">:</span>
                        <span class="n">lab_onset_date</span> <span class="o">=</span> <span class="n">lab_onset_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">onset_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">onset_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">lab_onset_date</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">lab_onset_date</span><span class="p">:</span>
                    <span class="n">lab_onset_date</span> <span class="o">=</span> <span class="n">lab_onset_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">onset_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">lab_onset_date</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_confirmation_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set confirmation date to today when creating a new investigation.&quot;&quot;&quot;</span>
        <span class="n">confirmation_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV162&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">confirmation_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_closed_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set investigation closed date to today when creating a new investigation.&quot;&quot;&quot;</span>
        <span class="n">closed_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME11163&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">closed_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_immpact_query_to_yes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the answer to the &quot;Was ImmPact Queried?&quot; question to yes.&quot;&quot;&quot;</span>
        <span class="n">immpact_query_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME10064101&quot;]/tbody/tr[9]/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">immpact_query_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_vaccination_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fill in all vaccination specific fields on the COVID tab after querying</span>
<span class="sd">        Immpact when creating a new investigation.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vaccinated_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME10064101&quot;]/tbody/tr[1]/td[2]/input&#39;</span>
            <span class="n">num_dose_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;VAC140&quot;]&#39;</span>
            <span class="n">last_dose_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;VAC142&quot;]&#39;</span>
            <span class="n">fully_vax_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME10064101&quot;]/tbody/tr[4]/td[2]/input&#39;</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">vaccinated_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">vaccinated_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">vaccinated_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">TAB</span><span class="p">)</span>
                <span class="n">num_doses</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_doses_prior_to_onset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">num_dose_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">num_doses</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">last_dose_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_dose_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">last_dose_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">last_dose_date</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">fully_vax_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCOVID</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_vaccination_fields</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_lab_testing_performed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the laboratory testing performed question to &#39;Yes&#39; when creating</span>
<span class="sd">        a new investigation.&quot;&quot;&quot;</span>
        <span class="n">lab_testing_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME58101&quot;]/tbody/tr/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">lab_testing_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_mmwr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the values of the MMWR week and year correctly based on first</span>
<span class="sd">        positive speciment collection date.&quot;&quot;&quot;</span>
        <span class="n">week_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV165&quot;]&#39;</span>
        <span class="n">year_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV166&quot;]&#39;</span>
        <span class="n">mmwr_date</span> <span class="o">=</span> <span class="n">Week</span><span class="o">.</span><span class="n">fromdate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span><span class="p">)</span>
        <span class="n">week</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mmwr_date</span><span class="o">.</span><span class="n">week</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">week</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">week</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">week</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mmwr_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">week_path</span><span class="p">)</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">week_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">week</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">year_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">year_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_jurisdiction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; After completing an investigation check if the patient&#39;s county and</span>
<span class="sd">        jurisdiction match. If a county is available that does not match the</span>
<span class="sd">        jurisdication then update the jurisdiction accordingly.&quot;&quot;&quot;</span>
        <span class="n">county_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;DEM165&quot;]&#39;</span>
        <span class="n">jurisdiction_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV107&quot;]&#39;</span>
        <span class="n">transfer_ownership_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/div/div/form/div[2]/div[1]/table[2]/tbody/tr/td[1]/table/tbody/tr/td[3]/input&#39;</span>
        <span class="n">new_jurisdiction_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;subsect_transferOwn&quot;]/tbody/tr[2]/td[2]/input&#39;</span>
        <span class="n">submit_jurisdiction_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;topButtId&quot;]/input[1]&#39;</span>
        <span class="n">county</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">county_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">county</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="n">jurisdiction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">jurisdiction_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">jurisdiction</span> <span class="ow">in</span> <span class="n">county</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">transfer_ownership_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">new_jurisdiction_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">new_jurisdiction_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">county</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_jurisdiction_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window_handle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_notification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;After completing a case create notification for it.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span><span class="s1">&#39;//*[@id=&quot;createNoti&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
        <span class="n">submit_button_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;botcreatenotId&quot;]/input[1]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_button_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_button_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window_handle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_bad_address_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Email the COVID Admin the list of patients with incomplete addresses.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_address_log</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;Hello COVID Admin Team,</span><span class="se">\n\n</span><span class="s1">The following cases have incomplete addresses:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_address_log</span><span class="p">:</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="o">+</span> <span class="nb">id</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-NBSbot(COVID open/close) AKA Hoover&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_smtp_email</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_admin_list</span><span class="p">,</span> <span class="s1">&#39;Incomplete Addresses&#39;</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="s1">&#39;incomplete address email&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Incomplete addresse log is empty. No email sent.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_failed_query_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Email the COVID Admin the list of patients where the Immpact query failed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_immpact_query_log</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;Hello COVID Commander,</span><span class="se">\n\n</span><span class="s1">The Immpact query for following cases failed:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_immpact_query_log</span><span class="p">:</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="o">+</span> <span class="nb">id</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-NBSbot(COVID open/close) AKA Hoover&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_smtp_email</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_commander</span><span class="p">,</span> <span class="s1">&#39;Failed Immpact Querries&#39;</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="s1">&#39;failed query email&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed query log is empty. No email sent.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pause_for_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; If the time is between midnight and 0200 pause until after 0200.&quot;&quot;&quot;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">stop_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span> <span class="o">=</span> <span class="mi">23</span><span class="p">,</span> <span class="n">minute</span> <span class="o">=</span> <span class="mi">55</span><span class="p">,</span> <span class="n">second</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">now</span> <span class="o">&gt;=</span> <span class="n">stop_time</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sleeping untill 02:05...&#39;</span><span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">3300</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_to_home</span><span class="p">()</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">3300</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_to_home</span><span class="p">()</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1200</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_to_home</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">NBS</span> <span class="o">=</span> <span class="n">COVIDlabreview</span><span class="p">(</span><span class="n">production</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

        </details>

            </section>
                <section id="COVIDlabreview">
                                <div class="attr class">
        <a class="headerlink" href="#COVIDlabreview">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">COVIDlabreview</span><wbr>(<span class="base">nbsdriver.NBSdriver</span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">COVIDlabreview</span><span class="p">(</span><span class="n">NBSdriver</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A class inherits all basic NBS functionality from NBSdriver and adds</span>
<span class="sd">    methods for reviewing unassigned COVID labs.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">production</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">COVIDlabreview</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">production</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_main_window_handle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_address_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failed_immpact_query_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unambigous_races</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;American Indian or Alaska Native&#39;</span>
                                  <span class="p">,</span><span class="s1">&#39;Asian&#39;</span>
                                  <span class="p">,</span><span class="s1">&#39;Black or African American&#39;</span>
                                  <span class="p">,</span><span class="s1">&#39;Native Hawaiian or Other Pacific Islander&#39;</span>
                                  <span class="p">,</span><span class="s1">&#39;White&#39;</span><span class="p">]</span>
        <span class="c1"># The xpaths are set here because they are required by multiple methods. This creates one maintenance point in the event of future change.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[2]/td[2]/input&#39;</span>
                                      <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[3]/td[2]/input&#39;</span>
                                      <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[4]/td[2]/input&#39;</span>
                                      <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[5]/td[2]/input&#39;</span>
                                      <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[6]/td[2]/input&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[1]/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">street_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;DEM159&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;DEM161&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;DEM163&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">county_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_15&quot;]/tbody/tr[6]/td[2]/input&#39;</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clear values of attributes assigned during case investigation review.</span>
<span class="sd">        To be used on initialization and between case reviews. &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">now_str</span> <span class="o">=</span> <span class="n">today</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address_complete</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_doses_prior_to_onset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_dose_date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">street</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">county</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_code</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">demo_race</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">demo_ethnicity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">investigation_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_window_handle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiple_possible_patients_in_immpact</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">get_db_connection_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read information required to connect to the NBS database.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;driver&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;server&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_rdb_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;rdb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_odse_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;odse&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_unassigned_covid_lab_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;unassigned_covid_lab_table&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_patient_list_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;patient_list_view&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_patient_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Execute a view in the nbs_odse database to return all patients in</span>
<span class="sd">        NBS including firt name, last name, birth date, and parent id. This data</span>
<span class="sd">        is then stored in a DataFrame for future use.&quot;&quot;&quot;</span>

        <span class="c1"># Connect to database</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RETRIEVE NBS PATIENT LIST:</span><span class="se">\n</span><span class="s1">Connecting to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_odse_name</span><span class="si">}</span><span class="s1"> database...&#39;</span><span class="p">)</span>
        <span class="n">Connection</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;Driver={&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_driver</span> <span class="o">+</span> <span class="s2">&quot;};&quot;</span>
                              <span class="sa">fr</span><span class="s2">&quot;Server=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_server</span><span class="si">}</span><span class="s2">;&quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;Database=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_odse_name</span><span class="si">}</span><span class="s2">;&quot;</span>
                              <span class="s2">&quot;Trusted_Connection=yes;&quot;</span><span class="p">)</span>
        <span class="c1"># Execute query and close connection</span>
        <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Connected to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_odse_name</span><span class="si">}</span><span class="s1">. Executing query...&#39;</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT PERSON_PARENT_UID, UPPER(FIRST_NM) AS FIRST_NM, UPPER(LAST_NM) AS LAST_NM, BIRTH_DT FROM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_patient_list_view</span><span class="si">}</span><span class="s2"> WHERE (FIRST_NM IS NOT NULL) AND (LAST_NM IS NOT NULL) AND (BIRTH_DT IS NOT NULL) AND (RECORD_STATUS_CD = &#39;ACTIVE&#39;)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">Connection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">Connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Data recieved and database connection closed.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_unassigned_covid_labs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Connect to the analyis NBS database and execute a query to return a</span>
<span class="sd">        list of all unassociated labs along with the data required to create</span>
<span class="sd">        investigations for them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_counties</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_min_delay</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_age_range</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_aoe_filters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_db_connection_info</span><span class="p">()</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lab_Local_ID&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;CAST(Lab_Rpt_Received_By_PH_Dt AS DATE) AS Lab_Rpt_Received_By_PH_Dt&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;CAST(Specimen_Coll_DT AS DATE) AS Specimen_Coll_DT&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Perform_Facility_Name&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;UPPER(First_Name) AS First_Name&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;UPPER(Middle_Name) AS Middle_Name&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;UPPER(Last_Name) AS Last_Name&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Patient_Local_ID&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Current_Sex_Cd&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;CAST(Birth_Dt AS DATE) AS Birth_Dt&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Patient_Race_Calc&#39;</span>
                        <span class="p">,</span><span class="s2">&quot;CASE WHEN Patient_Ethnicity = &#39;2186-5&#39; THEN &#39;Hispanic or Latino&#39; &quot;</span>
                        <span class="s2">&quot;WHEN Patient_Ethnicity = &#39;2135-2&#39; THEN &#39;Not Hispanic or Latino&#39; &quot;</span>
                        <span class="s2">&quot;ELSE &#39;Unknown&#39; END AS Patient_Ethnicity&quot;</span>
                        <span class="p">,</span><span class="s1">&#39;Patient_Death_Ind&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Patient_Death_Date&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Phone_Number&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Address_One&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Address_Two&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;City&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;State&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;County_Desc&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Jurisdiction_Nm&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;EMPLOYED_IN_HEALTHCARE&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;HOSPITALIZED&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;PATIENT_AGE&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;PREGNANT&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;RESIDENT_CONGREGATE_SETTING&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;SYMPTOMATIC_FOR_DISEASE&#39;</span>
                        <span class="p">,</span><span class="s2">&quot;CASE WHEN ILLNESS_ONSET_DATE LIKE &#39;[0-9][0-9][/-][0-9][0-9][/-][0-9][0-9][0-9][0-9]&#39; THEN CAST(ILLNESS_ONSET_DATE AS DATE) &quot;</span>
		                <span class="s2">&quot;WHEN ILLNESS_ONSET_DATE LIKE &#39;[0-9][0-9][0-9][0-9][/-][0-9][0-9][/-][0-9][0-9]&#39; THEN CAST(ILLNESS_ONSET_DATE AS DATE) &quot;</span>
		                <span class="s2">&quot;WHEN ILLNESS_ONSET_DATE LIKE &#39;[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]&#39; THEN CAST(ILLNESS_ONSET_DATE AS DATE) &quot;</span>
		                <span class="s2">&quot;ELSE NULL END AS ILLNESS_ONSET_DATE&quot;</span>
                        <span class="p">,</span><span class="s1">&#39;FIRST_RESPONDER&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;TestType&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;DATEDIFF(DAY, CAST(Specimen_Coll_DT AS DATE), GETDATE()) AS review_delay&#39;</span>
                        <span class="p">)</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
        <span class="c1"># If a lab is not positive an investigation should not be created for it.</span>
        <span class="c1"># All cases with AOEs indicating hospitalization, or death should be assigned out for investigation. These cases should not be opened and closed.</span>
        <span class="n">where</span> <span class="o">=</span> <span class="s2">&quot;WHERE (Result_Category = &#39;Positive&#39;) AND (State = &#39;ME&#39;) AND (TestType IN (&#39;PCR&#39;, &#39;Antigen&#39;)) AND (HOSPITALIZED IS NULL OR UPPER(HOSPITALIZED) NOT LIKE &#39;Y%&#39;) AND (ICU IS NULL OR UPPER(ICU) NOT LIKE &#39;Y%&#39;) AND (Patient_Death_Ind IS NULL OR UPPER(Patient_Death_Ind) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; AND (DATEDIFF(DAY, Lab_Rpt_Received_By_PH_Dt ,GETDATE())) &gt;= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; AND (DATEDIFF(DAY, CAST(Birth_Dt AS DATE), CAST(Specimen_Coll_DT AS DATE))/365.25 &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_age</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; AND (DATEDIFF(DAY, CAST(Birth_Dt AS DATE), CAST(Specimen_Coll_DT AS DATE))/365.25 &lt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_age</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cong_aoe_lab</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="s2">&quot; AND (RESIDENT_CONGREGATE_SETTING IS NULL OR UPPER(RESIDENT_CONGREGATE_SETTING) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hcw_aoe_lab</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="s2">&quot; AND (EMPLOYED_IN_HEALTHCARE IS NULL OR UPPER(EMPLOYED_IN_HEALTHCARE) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">responder_aoe_lab</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="s2">&quot; AND (FIRST_RESPONDER IS NULL OR UPPER(FIRST_RESPONDER) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pregnant_aoe_lab</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="s2">&quot; AND (PREGNANT IS NULL OR UPPER(PREGNANT) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="s1">&#39;ORDER BY Lab_Rpt_Received_By_PH_Dt&#39;</span>
        <span class="c1"># Construct Query</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;SELECT&#39;</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="s1">&#39;FROM&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbs_unassigned_covid_lab_table</span><span class="p">,</span> <span class="n">where</span><span class="p">,</span> <span class="n">order_by</span><span class="p">]</span> <span class="p">)</span>
        <span class="c1"># Connect to database</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RETRIEVE UNASSOCIATED LAB LIST:</span><span class="se">\n</span><span class="s1">Connecting to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_rdb_name</span><span class="si">}</span><span class="s1"> database...&#39;</span><span class="p">)</span>
        <span class="n">Connection</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;Driver={&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_driver</span> <span class="o">+</span> <span class="s2">&quot;};&quot;</span>
                              <span class="sa">fr</span><span class="s2">&quot;Server=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_server</span><span class="si">}</span><span class="s2">;&quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;Database=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_rdb_name</span><span class="si">}</span><span class="s2">;&quot;</span>
                              <span class="s2">&quot;Trusted_Connection=yes;&quot;</span><span class="p">)</span>
        <span class="c1"># Execute query and close connection</span>
        <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Connected to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_rdb_name</span><span class="si">}</span><span class="s1">. Executing query...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">Connection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">County_Desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">County_Desc</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; County&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">Connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">Jurisdiction_Nm</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">Patient_Local_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">Patient_Local_ID</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clean_patient_id</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Data recieved and database connection closed.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">select_counties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A method to prompt the user to specify which counties unassociated labs should be review from.&quot;&quot;&quot;</span>
        <span class="n">maine_counties</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Androscoggin&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Aroostook&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Cumberland&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Franklin&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Hancock&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Kennebec&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Knox&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Lincoln&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Oxford&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Penobscot&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Piscataquis&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Sagadahoc&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Somerset&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Waldo&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Washington&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;York&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">county</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">maine_counties</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">county</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counties</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;COUNTY SLECTION:</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Choose the counties from which to review unassocated labs.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Make your selection by entering the row numbers of the desired counties separated by commas.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;For example, to select Cumberland and York counties enter &quot;2,15&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Press enter to skip this step and review unassociated labs from all counties.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">counties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">counties</span> <span class="o">=</span> <span class="p">[</span><span class="n">maine_counties</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="p">)]</span><span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">select_min_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A method to prompt the user to specify the minimum delay in reviewing unassociated labs.</span>
<span class="sd">        If 3 is select then NBSbot will only review unassocated labs that were reported 3 or more days ago.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET MINIMUM REVIEW DELAY:</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Enter the minimum integer number of days between the date a lab was collected and today that unassociated labs should be reviewed from.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Enter &quot;0&quot; or simply press enter to skip this step and review all unassociated labs regardless of review delay.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_age_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prompt user to provide the minimum and maximum patient age of unassociated labs to be opened and closed.&quot;&quot;&quot;</span>
        <span class="n">default_min</span> <span class="o">=</span> <span class="s1">&#39;-5&#39;</span>
        <span class="n">default_max</span> <span class="o">=</span> <span class="s1">&#39;150&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_age</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET MINIMUM AGE:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;Enter the minimum age in years that cases should be opened and closed for.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;If no age is specified the minimum value will be set to </span><span class="si">{</span><span class="n">default_min</span><span class="si">}</span><span class="s1"> years.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_age</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET MAXIMUM AGE:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;Enter the maximum age in years that cases should be opened and closed for.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;If no age is specified the maximum value will be set to </span><span class="si">{</span><span class="n">default_max</span><span class="si">}</span><span class="s1"> years.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_age</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_age</span> <span class="o">=</span> <span class="n">default_min</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_age</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_age</span> <span class="o">=</span> <span class="n">default_max</span>

    <span class="k">def</span> <span class="nf">select_aoe_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prompt user to decide if they would like to filter out unassociated las on the basis of affirmative AOE respones.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cong_aoe_lab</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET CONGREGATE AOE FILTER:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;0: Review unassociated labs with an affirmative congregate setting AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;1: DO NOT review unassociated labs with an affirmative congregate setting AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;To review labs with an affirmative congregte setting AOE response enter &quot;0&quot; or simply press enter.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;If you would NOT like to review unasocciated labs with an affiramtive congregate setting AOE enter &quot;1&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hcw_aoe_lab</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET HEALTHCARE WORKER AOE FILTER:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;0: Review unassociated labs with an affirmative heathcare worker AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;1: DO NOT review unassociated labs with an affirmative healthcare worker AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;To review labs with an affirmative healthcare worker AOE response enter &quot;0&quot; or simply press enter.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;If you would NOT like to review unasocciated labs with an affiramtive healthcare worker AOE enter &quot;1&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">responder_aoe_lab</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET FIRST RESPONDER AOE FILTER:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;0: Review unassociated labs with an affirmative first responder AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;1: DO NOT review unassociated labs with an affirmative frist responder AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;To review labs with an affirmative first responder AOE response enter &quot;0&quot; or simply press enter.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;If you would NOT like to review unasocciated labs with an affiramtive first responder AOE enter &quot;1&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pregnant_aoe_lab</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET PREGNANT AOE FILTER:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;0: Review unassociated labs with an affirmative congregate setting AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;1: DO NOT  Review unassociated labs with an affirmative congregate setting AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;To review labs with an affirmative congregte setting AOE response enter &quot;0&quot; or simply press enter.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;If you would NOT like to review unasocciated labs with an affiramtive congregate setting AOE enter &quot;1&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_for_possible_merges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">lname</span><span class="p">,</span> <span class="n">dob</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Given a patient&#39;s first name, last name, and dob search for possible</span>
<span class="sd">        matches amoung all patients in NBS.&quot;&quot;&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">FIRST_NM</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">fname</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">LAST_NM</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">lname</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">BIRTH_DT</span> <span class="o">==</span> <span class="n">dob</span><span class="p">)]</span>
        <span class="n">unique_profiles</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">PERSON_PARENT_UID</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_profiles</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">possible_merges</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">possible_merges</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">possible_merges</span>

    <span class="k">def</span> <span class="nf">check_patient_hospitalization_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check Patient Status at Specimen Collection from inside a lab report.</span>
<span class="sd">        Occasionally there are cases that indicate a status of &#39;inpatient&#39; without an AOE inidicating a hospitalization.</span>
<span class="sd">        In this case the bot will not open and closed a case, but instead leave the lab for human review.&quot;&quot;&quot;</span>
        <span class="n">patient_status_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_LAB330&quot;]&#39;</span>
        <span class="n">patient_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">patient_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">patient_status</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;HOSPITALIZED&#39;</span><span class="p">,</span> <span class="s1">&#39;INPATIENT&#39;</span><span class="p">]:</span>
            <span class="n">possible_hospitalization</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">possible_hospitalization</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">possible_hospitalization</span>

    <span class="k">def</span> <span class="nf">check_for_existing_investigation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Review the Investigations table in the Events tab of a patient profile</span>
<span class="sd">        to determine if the case already has an existing investigation. &quot;&quot;&quot;</span>
        <span class="n">investigation_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_investigation_table</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">investigation_table</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">investigation_table</span><span class="p">[</span><span class="s1">&#39;days_prior&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">investigation_table</span><span class="p">[</span><span class="s1">&#39;Start Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">collection_date</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">date</span><span class="p">())</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
            <span class="n">existing_investigations</span> <span class="o">=</span> <span class="n">investigation_table</span><span class="p">[(</span><span class="n">investigation_table</span><span class="o">.</span><span class="n">days_prior</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">)</span>
                                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">investigation_table</span><span class="o">.</span><span class="n">days_prior</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">35</span><span class="p">)</span>
                                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">investigation_table</span><span class="o">.</span><span class="n">Condition</span> <span class="o">==</span> <span class="s1">&#39;2019 Novel Coronavirus (2019-nCoV)&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_investigations</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span> <span class="o">=</span> <span class="n">existing_investigations</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">inv_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_investigations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">existing_investigations</span><span class="p">[</span><span class="s1">&#39;Case Status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Not a Case&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">existing_not_a_case</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">existing_not_a_case</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">inv_found</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">existing_not_a_case</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inv_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">existing_not_a_case</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">inv_found</span><span class="p">,</span> <span class="n">existing_not_a_case</span>

    <span class="k">def</span> <span class="nf">create_investigation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new investigation from within a lab report when one does not already exist .&quot;&quot;&quot;</span>
        <span class="n">create_investigation_button_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;doc3&quot;]/div[2]/table/tbody/tr/td[2]/input[1]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">create_investigation_button_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">create_investigation_button_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">select_condition_field_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ccd_ac_table&quot;]/tbody/tr[1]/td/input&#39;</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="s1">&#39;2019 Novel Coronavirus (2019-nCoV)&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">select_condition_field_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">select_condition_field_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
        <span class="n">submit_button_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/table/tbody/tr/td/table/tbody/tr[3]/td/table/thead/tr[2]/td/div/table/tbody/tr/td/table/tbody/tr/td[4]/table[1]/tbody/tr[1]/td/input&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_button_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_button_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">associate_lab_with_investigation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Associate a lab with an existing investigation when one for the case has already been started.&quot;&quot;&quot;</span>
        <span class="n">lab_report_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;events1&quot;]&#39;</span>
        <span class="n">lab_report_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">lab_report_table_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lab_report_table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lab_row_index</span> <span class="o">=</span> <span class="n">lab_report_table</span><span class="p">[</span><span class="n">lab_report_table</span><span class="p">[</span><span class="s1">&#39;Event ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">lab_id</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lab_row_index</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lab_row_index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">lab_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/html/body/div[2]/div/form/div/div/div/table[2]/tbody/tr/td/table/tbody/tr[</span><span class="si">{</span><span class="n">lab_row_index</span><span class="si">}</span><span class="s1">]/td[1]/div/input&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">lab_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span><span class="n">lab_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">query_immpact</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Click the query registry button, submit the query to immpact, and read the results into a DataFrame.&quot;&quot;&quot;</span>
        <span class="n">query_registry_button</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;events3&quot;]/tbody/tr/td/div/input[1]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">query_registry_button</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">query_registry_button</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
        <span class="n">submit_query</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;doc4&quot;]/div[2]/input[1]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_query</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
        <span class="n">results_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;section1&quot;]/div/table&#39;</span>
        <span class="n">results_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">results_table_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results_table</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">results_table</span><span class="p">[</span><span class="s1">&#39;Patient Name&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Nothing found to display.&#39;</span><span class="p">):</span>
            <span class="n">record_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;parent&quot;]/tbody/tr/td[1]/a&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">record_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
            <span class="n">vax_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;section1&quot;]/div/table[2]&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">vax_table_path</span><span class="p">)</span>
            <span class="n">good_query</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">good_query</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Immpact returned more than one patient as a possible, or found no matching patients. Unable to proceed with the automated query.&#39;</span><span class="p">)</span>
            <span class="n">cancel_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/form/div[2]/div/div[1]/input&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">cancel_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">alert</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results_table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiple_possible_patients_in_immpact</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">good_query</span>

    <span class="k">def</span> <span class="nf">id_covid_vaccinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Identify COVID vaccines by their specific brand.&quot;&quot;&quot;</span>
        <span class="n">covid_vax_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pfizer&#39;</span><span class="p">:</span><span class="s1">&#39;COVID-19, mRNA, LNP-S, PF, 30 mcg/0.3 mL dose&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Moderna&#39;</span><span class="p">:</span><span class="s1">&#39;COVID-19, mRNA, LNP-S, PF, 100 mcg/ 0.5 mL dose&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;JJ&#39;</span><span class="p">:</span><span class="s1">&#39;COVID-19 vaccine, vector-nr, rS-Ad26, PF, 0.5 mL&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Pfizer_5to12&#39;</span><span class="p">:</span> <span class="s1">&#39;Tris-sucrose formula, 10 mcg/0.2 mL for ages 5 yrs to &lt; 12 yrs&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">covid_vax_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="p">[</span><span class="s1">&#39;Vaccine Administered&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">covid_vax_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">Pfizer</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">Moderna</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">JJ</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">Pfizer_5to12</span><span class="p">]</span>
        <span class="c1">#self.covid_vaccinations[&#39;Date Administered&#39;] = pd.to_datetime(self.covid_vaccinations[&#39;Date Administered&#39;])</span>
        <span class="c1">#self.covid_vaccinations[&#39;Date Administered&#39;] = self.covid_vaccinations[&#39;Date Administered&#39;].dt.date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">(),</span> <span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>

    <span class="k">def</span> <span class="nf">import_covid_vaccinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Select all COVID vaccinations in the list returned by Immpact and import them.&quot;&quot;&quot;</span>
        <span class="n">covid_vax_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">num_covid_vaccinations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">covid_vax_indexes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_covid_vaccinations</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">covid_vax_indexes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">select_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/form/div[2]/div/div[4]/div/table[2]/tbody/tr/td/table/tbody/tr/td[1]/input&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">select_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">covid_vax_indexes</span><span class="p">:</span>
                    <span class="n">select_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/html/body/form/div[2]/div/div[4]/div/table[2]/tbody/tr/td/table/tbody/tr[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">]/td[1]/input&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">select_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="n">import_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/form/div[2]/div/div[1]/input[1]&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">import_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">alert</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_handles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_handles</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">handle</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window_handle</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window_handle</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">failed_immpact_query_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cancel_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/form/div[2]/div/div[1]/input[2]&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">cancel_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">alert</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">determine_vaccination_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Determine vaccination status at time of illness and other required vaccination data points.&quot;&quot;&quot;</span>
        <span class="n">covid_vaccinations_prior_to_onset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">collection_date</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_doses_prior_to_onset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">covid_vaccinations_prior_to_onset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_dose_date</span> <span class="o">=</span> <span class="n">covid_vaccinations_prior_to_onset</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">complete_vaccinations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">collection_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">))]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">Pfizer</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">Moderna</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">JJ</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">Pfizer_5to12</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_vaccinated</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">read_street</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read the current street address.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">street</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">street_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_city</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the current city/town.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the current zip code. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write zip code. Intended for use after looking up a missing zip code with zip_code_lookup().&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zip_code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_county</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the current county. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">county</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">county_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_county</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write county. Intended for use after looking up a missing missing count with county_lookup().&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">county_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">county</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read parts of the patient address except for state and country.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_street</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_city</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_zip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_county</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set state value in patient address.&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_15&quot;]/tbody/tr[4]/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_country</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">country</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set country value in patient address.&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_15&quot;]/tbody/tr[7]/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">country</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_ethnicity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if ethnicity is completed and if not set the values to unknown.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear_ambiguous_race_answers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Ensure all ambiguous race answers (refused to answer, not answered, and unknown) are not selected.&quot;&quot;&quot;</span>
        <span class="n">ambiguous_answer_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[8]/td[2]/input&#39;</span>
                                 <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[9]/td[2]/input&#39;</span>
                                 <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[10]/td[2]/input&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">ambiguous_answer_paths</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unselect_checkbox</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_race</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Review current race value. If any combination of non-ambiguous options</span>
<span class="sd">        are selection make sure all other choice are not selected. Accept &quot;other&quot;</span>
<span class="sd">        only when no unambigious answer is present. When race is not clearly</span>
<span class="sd">        defined or other set value to unknown.&quot;&quot;&quot;</span>
        <span class="n">other_race_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[7]/td[2]/input&#39;</span>
        <span class="n">unknown_race_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[10]/td[2]/input&#39;</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race_paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">is_selected</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_ambiguous_race_answers</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unselect_checkbox</span><span class="p">(</span><span class="n">other_race_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">other_race_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_selected</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_checkbox</span><span class="p">(</span><span class="n">other_race_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">unknown_race_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">read_demographic_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read address table from the demographics tab of a patient profile and</span>
<span class="sd">        select the most recent address from within the last year that is consistent</span>
<span class="sd">        with all parts of the address reported in the current lab report.&quot;&quot;&quot;</span>
        <span class="n">address_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;patSearch8&quot;]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">address_table_path</span><span class="p">)))</span>
        <span class="n">address_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">address_table_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">address_table</span><span class="p">)</span> <span class="o">!=</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">address_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">address_table_path</span><span class="p">)</span>
        <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="p">[</span><span class="n">address_table</span><span class="p">[</span><span class="s1">&#39;As of&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="n">address_table</span><span class="p">[</span><span class="s1">&#39;As of&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">address_table</span><span class="p">[</span><span class="s1">&#39;As of&#39;</span><span class="p">],</span> <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y&quot;</span><span class="p">)</span>
        <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="p">[</span><span class="s1">&#39;As of&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">))]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">address_table</span><span class="o">.</span><span class="n">Zip</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">Zip</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="k">else</span> <span class="n">x</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">street</span><span class="p">:</span>
            <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="o">.</span><span class="n">Address</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">street</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="p">:</span>
            <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="o">.</span><span class="n">City</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
        <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="o">.</span><span class="n">State</span> <span class="o">==</span> <span class="s1">&#39;Maine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_code</span><span class="p">:</span>
            <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="o">.</span><span class="n">Zip</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">street</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">address_table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">write_demographic_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; After reading an address from the demographics tab, moving back into</span>
<span class="sd">        an investigation, and entering edit mode, write the data to the address</span>
<span class="sd">        fields.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">street_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span><span class="o">.</span><span class="n">Address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span><span class="o">.</span><span class="n">City</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span><span class="o">.</span><span class="n">Zip</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">county_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span><span class="o">.</span><span class="n">Address</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_demographic_race</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the race table in the demographics tab and select the most recent</span>
<span class="sd">        nonambigous value, if present.&quot;&quot;&quot;</span>
        <span class="n">race_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;patSearch14&quot;]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">race_table_path</span><span class="p">)))</span>
        <span class="n">race_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">race_table_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">race_table</span><span class="p">)</span> <span class="o">!=</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">race_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">race_table_path</span><span class="p">)</span>
        <span class="n">all_race_values</span> <span class="o">=</span> <span class="n">race_table</span><span class="o">.</span><span class="n">Race</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">unambiguous_race_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_race_values</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unambigous_races</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">unambiguous_race_values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">demo_race</span> <span class="o">=</span> <span class="n">unambiguous_race_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">write_demographic_race</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; After reading a race from the demographics tab, moving back into an</span>
<span class="sd">        investigation, and entering edit mode, write the data to the race field.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">race</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unambigous_races</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race_paths</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">race</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demo_race</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_checkbox</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_ambiguous_race_answers</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">read_demographic_ethnicity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the ethnicity table in the demographics tab and select the most</span>
<span class="sd">        recent non-unknown value, if present.&quot;&quot;&quot;</span>
        <span class="n">ethnicity_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS108&quot;]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">ethnicity_path</span><span class="p">)))</span>
        <span class="n">ethnicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">ethnicity_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ethnicity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Hispanic or Latino&#39;</span><span class="p">,</span> <span class="s1">&#39;Not Hispanic or Latino&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">demo_ethnicity</span> <span class="o">=</span> <span class="n">ethnicty</span>

    <span class="k">def</span> <span class="nf">write_demographic_ethnicity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; After reading an ethnicity from the demographics tab, moving back into an</span>
<span class="sd">        investigation, and entering edit mode, write the data to the ethnicity field.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_ethnicity</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_investigation_start_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set investigation start date to today.&quot;&quot;&quot;</span>
        <span class="n">start_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV147&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">start_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_investigation_status_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set investigation status to closed.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">incestigation_status_down_arrow</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_19&quot;]/tbody/tr[4]/td[2]/img&#39;</span>
            <span class="n">closed_option</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV109&quot;]/option[1]&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">incestigation_status_down_arrow</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">closed_option</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_investigation_status_closed</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_state_case_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the State Case ID to the NBS patient ID.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">state_case_id_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV173&quot;]&#39;</span>
            <span class="n">patient_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadPatientID</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">state_case_id_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_state_case_id</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">read_investigation_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; From within an investigation read the investigation id.&quot;&quot;&quot;</span>
        <span class="n">investigation_id_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/div/div/form/div[2]/div[1]/table[3]/tbody/tr[2]/td[1]/span[2]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">investigation_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">investigation_id_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_county_and_state_report_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_to_ph_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set Earliest Date Reported to County and Earliest Date Reported to</span>
<span class="sd">        State based on Lab_Rpt_Received_By_PH_Dt. This method may be used when</span>
<span class="sd">        creating new investigations or when associating additional labs with an</span>
<span class="sd">        existing investigation. In the case where there is an existing report</span>
<span class="sd">        date in the existing invesitigation it will only be replaced when the</span>
<span class="sd">        provided report date is earlier.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">report_date_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;//*[@id=&quot;INV120&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;//*[@id=&quot;INV121&quot;]&#39;</span><span class="p">]</span>
            <span class="n">report_to_ph_date_str</span> <span class="o">=</span> <span class="n">report_to_ph_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">report_date_paths</span><span class="p">:</span>
                <span class="n">current_report_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadDate</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current_report_date</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">report_to_ph_date</span> <span class="o">&lt;</span> <span class="n">current_report_date</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span> <span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">report_to_ph_date_str</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">report_to_ph_date_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_county_and_state_report_dates</span><span class="p">(</span><span class="n">report_to_ph_date</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_report_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_to_ph_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;When associating a lab with an existing investigation check to see if</span>
<span class="sd">        the new lab was reported prior to the report date currently assigned to</span>
<span class="sd">        the investigation. If so, replace it with the report date of the new lab.</span>
<span class="sd">        If not, do nothing.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">report_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV111&quot;]&#39;</span>
            <span class="n">current_report_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadDate</span><span class="p">(</span><span class="n">report_date_path</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="n">report_to_ph_date_str</span> <span class="o">=</span> <span class="n">report_to_ph_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current_report_date</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">report_to_ph_date</span> <span class="o">&lt;</span> <span class="n">current_report_date</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">report_date_path</span> <span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">report_date_path</span> <span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">report_to_ph_date_str</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">report_to_ph_date</span> <span class="o">=</span> <span class="n">report_to_ph_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">report_date_path</span> <span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">report_to_ph_date_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_report_date</span><span class="p">(</span><span class="n">report_to_ph_date</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_performing_lab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">performing_lab</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set performing laboratory name based on lab report.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">performing_lab</span><span class="p">:</span>
                <span class="n">performing_lab_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME6105&quot;]&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">performing_lab_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">performing_lab</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_performing_lab</span><span class="p">(</span><span class="n">performing_lab</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_earliest_positive_collection_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_collection_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read the earliest positive speciment collection date field. If there</span>
<span class="sd">        is a date present and it is prior to the collection of the current lab do</span>
<span class="sd">        nothing. In the event that the field is blank or the collection of the</span>
<span class="sd">        current lab is prior to the current value of the field, set the value to</span>
<span class="sd">        the collection date of the current lab. This additional check allows this</span>
<span class="sd">        method to be used when creating investigations or associating labs with</span>
<span class="sd">        existing investigations.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">collection_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS550&quot;]&#39;</span>
            <span class="n">lab_collection_date_str</span> <span class="o">=</span> <span class="n">lab_collection_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadDate</span><span class="p">(</span><span class="n">collection_date_path</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span> <span class="o">=</span> <span class="n">lab_collection_date</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">collection_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">collection_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">lab_collection_date_str</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lab_collection_date</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span> <span class="o">=</span> <span class="n">lab_collection_date</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">collection_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">collection_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">lab_collection_date_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_earliest_positive_collection_date</span><span class="p">(</span><span class="n">lab_collection_date</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_case_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set all three fields related to case status based on the provided status.&quot;&quot;&quot;</span>
        <span class="n">current_status_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_GA21015&quot;]/tbody/tr[3]/td[2]/input&#39;</span>
        <span class="n">probable_reason_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_GA21015&quot;]/tbody/tr[4]/td[2]/input&#39;</span>
        <span class="n">case_status_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_2&quot;]/tbody/tr[5]/td[2]/input&#39;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;Confirmed&#39;</span><span class="p">:</span>
            <span class="n">current_status</span> <span class="o">=</span> <span class="s1">&#39;Laboratory-confirmed case&#39;</span>
            <span class="n">probable_reason</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;Probable&#39;</span><span class="p">:</span>
            <span class="n">current_status</span> <span class="o">=</span> <span class="s1">&#39;Probable Case&#39;</span>
            <span class="n">probable_reason</span> <span class="o">=</span> <span class="s1">&#39;Meets Presump Lab and Clinical or Epi&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">current_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">current_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">current_status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">probable_reason_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">probable_reason_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">probable_reason</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">case_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">case_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">review_case_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Review current case status and current lab type. Then set case status</span>
<span class="sd">        accordingly. This method can be used for creating investigations or</span>
<span class="sd">        associating additional labs with existing investigations.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">case_status_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_2&quot;]/tbody/tr[5]/td[2]/input&#39;</span>
            <span class="n">current_case_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">case_status_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lab_type</span> <span class="o">==</span> <span class="s1">&#39;PCR&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_case_status</span><span class="p">(</span><span class="s1">&#39;Confirmed&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lab_type</span> <span class="o">==</span> <span class="s1">&#39;Antigen&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_case_status</span><span class="p">(</span><span class="s1">&#39;Probable&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">review_case_status</span><span class="p">(</span><span class="n">lab_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_aoe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">,</span> <span class="n">lab_aoe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update a specific AOE associated investigation field by considering</span>
<span class="sd">        its current value and the value in the current lab. An affirmative</span>
<span class="sd">        response in either the investigation or the lab takes precedence, followed</span>
<span class="sd">        by negative, unknown, and null responses respectively.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lab_aoe</span><span class="p">:</span>
                <span class="n">investigation_aoe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">aoe_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;No&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;No&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_aoe</span><span class="p">(</span><span class="n">aoe_path</span><span class="p">,</span> <span class="n">lab_aoe</span><span class="p">,</span> <span class="s1">&#39;case_info&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_case_info_aoes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hosp_aoe</span><span class="p">,</span> <span class="n">cong_aoe</span><span class="p">,</span> <span class="n">responder_aoe</span><span class="p">,</span> <span class="n">hcw_aoe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update every AOE on the Case Info tabe using the update_aoe() method.&quot;&quot;&quot;</span>
        <span class="n">aoe_dictionary</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_NBS_INV_GENV2_UI_3&quot;]/tbody/tr[1]/td[2]/input&#39;</span> <span class="p">:</span> <span class="n">hosp_aoe</span>
                         <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;ME59136&quot;]/tbody/tr[3]/td[2]/input&#39;</span> <span class="p">:</span> <span class="n">cong_aoe</span>
                         <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;ME59137&quot;]/tbody/tr[1]/td[2]/input&#39;</span> <span class="p">:</span> <span class="n">responder_aoe</span>
                         <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;UI_ME59106&quot;]/tbody/tr[1]/td[2]/input&#39;</span> <span class="p">:</span> <span class="n">hcw_aoe</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">aoe_path</span><span class="p">,</span> <span class="n">aoe_value</span> <span class="ow">in</span> <span class="n">aoe_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">aoe_value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_aoe</span><span class="p">(</span><span class="n">aoe_path</span><span class="p">,</span> <span class="n">aoe_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_pregnant_aoe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pregnant_aoe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update pregnancy status AOE on COVID tab.&quot;&quot;&quot;</span>
        <span class="n">lab_aoe</span> <span class="o">=</span> <span class="n">pregnant_aoe</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lab_aoe</span><span class="p">:</span>
                <span class="n">aoe_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME58100&quot;]/tbody/tr[1]/td[2]/input&#39;</span>
                <span class="n">investigation_aoe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">aoe_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;No&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;No&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">update_symptom_aoe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_symptom_aoe</span><span class="p">,</span> <span class="n">lab_onset_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update symptom status based on values in an investigation and values</span>
<span class="sd">        reported in the current lab.&quot;&quot;&quot;</span>
        <span class="n">symptom_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_GA21003&quot;]/tbody/tr[3]/td[2]/input&#39;</span>
        <span class="n">onset_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV137&quot;]&#39;</span>
        <span class="n">investigation_symptom_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">symptom_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lab_onset_date</span><span class="p">:</span>
            <span class="n">lab_symptom_aoe</span> <span class="o">=</span> <span class="s1">&#39;Yes&#39;</span>
        <span class="k">if</span> <span class="n">lab_symptom_aoe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">symptom_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">investigation_symptom_status</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_symptom_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">symptom_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_symptom_status</span> <span class="o">==</span> <span class="s1">&#39;No&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_symptom_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">symptom_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;No&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_symptom_status</span> <span class="o">==</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_symptom_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">symptom_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">investigation_symptom_status</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">:</span>
                <span class="n">investigation_onset_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadDate</span><span class="p">(</span><span class="n">onsed_date_path</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">investigation_onset_date</span> <span class="ow">and</span> <span class="n">lab_onset_date</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">lab_onset_date</span> <span class="o">&lt;</span> <span class="n">investigation_onset_date</span><span class="p">:</span>
                        <span class="n">lab_onset_date</span> <span class="o">=</span> <span class="n">lab_onset_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">onset_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">onset_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">lab_onset_date</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">lab_onset_date</span><span class="p">:</span>
                    <span class="n">lab_onset_date</span> <span class="o">=</span> <span class="n">lab_onset_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">onset_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">lab_onset_date</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_confirmation_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set confirmation date to today when creating a new investigation.&quot;&quot;&quot;</span>
        <span class="n">confirmation_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV162&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">confirmation_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_closed_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set investigation closed date to today when creating a new investigation.&quot;&quot;&quot;</span>
        <span class="n">closed_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME11163&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">closed_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_immpact_query_to_yes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the answer to the &quot;Was ImmPact Queried?&quot; question to yes.&quot;&quot;&quot;</span>
        <span class="n">immpact_query_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME10064101&quot;]/tbody/tr[9]/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">immpact_query_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_vaccination_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fill in all vaccination specific fields on the COVID tab after querying</span>
<span class="sd">        Immpact when creating a new investigation.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vaccinated_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME10064101&quot;]/tbody/tr[1]/td[2]/input&#39;</span>
            <span class="n">num_dose_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;VAC140&quot;]&#39;</span>
            <span class="n">last_dose_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;VAC142&quot;]&#39;</span>
            <span class="n">fully_vax_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME10064101&quot;]/tbody/tr[4]/td[2]/input&#39;</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">vaccinated_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">vaccinated_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">vaccinated_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">TAB</span><span class="p">)</span>
                <span class="n">num_doses</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_doses_prior_to_onset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">num_dose_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">num_doses</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">last_dose_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_dose_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">last_dose_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">last_dose_date</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">fully_vax_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCOVID</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_vaccination_fields</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_lab_testing_performed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the laboratory testing performed question to &#39;Yes&#39; when creating</span>
<span class="sd">        a new investigation.&quot;&quot;&quot;</span>
        <span class="n">lab_testing_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME58101&quot;]/tbody/tr/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">lab_testing_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_mmwr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the values of the MMWR week and year correctly based on first</span>
<span class="sd">        positive speciment collection date.&quot;&quot;&quot;</span>
        <span class="n">week_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV165&quot;]&#39;</span>
        <span class="n">year_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV166&quot;]&#39;</span>
        <span class="n">mmwr_date</span> <span class="o">=</span> <span class="n">Week</span><span class="o">.</span><span class="n">fromdate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span><span class="p">)</span>
        <span class="n">week</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mmwr_date</span><span class="o">.</span><span class="n">week</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">week</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">week</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">week</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mmwr_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">week_path</span><span class="p">)</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">week_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">week</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">year_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">year_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_jurisdiction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; After completing an investigation check if the patient&#39;s county and</span>
<span class="sd">        jurisdiction match. If a county is available that does not match the</span>
<span class="sd">        jurisdication then update the jurisdiction accordingly.&quot;&quot;&quot;</span>
        <span class="n">county_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;DEM165&quot;]&#39;</span>
        <span class="n">jurisdiction_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV107&quot;]&#39;</span>
        <span class="n">transfer_ownership_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/div/div/form/div[2]/div[1]/table[2]/tbody/tr/td[1]/table/tbody/tr/td[3]/input&#39;</span>
        <span class="n">new_jurisdiction_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;subsect_transferOwn&quot;]/tbody/tr[2]/td[2]/input&#39;</span>
        <span class="n">submit_jurisdiction_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;topButtId&quot;]/input[1]&#39;</span>
        <span class="n">county</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">county_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">county</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="n">jurisdiction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">jurisdiction_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">jurisdiction</span> <span class="ow">in</span> <span class="n">county</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">transfer_ownership_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">new_jurisdiction_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">new_jurisdiction_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">county</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_jurisdiction_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window_handle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_notification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;After completing a case create notification for it.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span><span class="s1">&#39;//*[@id=&quot;createNoti&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
        <span class="n">submit_button_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;botcreatenotId&quot;]/input[1]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_button_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_button_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window_handle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_bad_address_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Email the COVID Admin the list of patients with incomplete addresses.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_address_log</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;Hello COVID Admin Team,</span><span class="se">\n\n</span><span class="s1">The following cases have incomplete addresses:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_address_log</span><span class="p">:</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="o">+</span> <span class="nb">id</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-NBSbot(COVID open/close) AKA Hoover&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_smtp_email</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_admin_list</span><span class="p">,</span> <span class="s1">&#39;Incomplete Addresses&#39;</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="s1">&#39;incomplete address email&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Incomplete addresse log is empty. No email sent.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_failed_query_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Email the COVID Admin the list of patients where the Immpact query failed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_immpact_query_log</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;Hello COVID Commander,</span><span class="se">\n\n</span><span class="s1">The Immpact query for following cases failed:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_immpact_query_log</span><span class="p">:</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="o">+</span> <span class="nb">id</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-NBSbot(COVID open/close) AKA Hoover&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_smtp_email</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_commander</span><span class="p">,</span> <span class="s1">&#39;Failed Immpact Querries&#39;</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="s1">&#39;failed query email&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed query log is empty. No email sent.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pause_for_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; If the time is between midnight and 0200 pause until after 0200.&quot;&quot;&quot;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">stop_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span> <span class="o">=</span> <span class="mi">23</span><span class="p">,</span> <span class="n">minute</span> <span class="o">=</span> <span class="mi">55</span><span class="p">,</span> <span class="n">second</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">now</span> <span class="o">&gt;=</span> <span class="n">stop_time</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sleeping untill 02:05...&#39;</span><span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">3300</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_to_home</span><span class="p">()</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">3300</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_to_home</span><span class="p">()</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1200</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_to_home</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>A class inherits all basic NBS functionality from NBSdriver and adds
methods for reviewing unassigned COVID labs.</p>
</div>


                            <div id="COVIDlabreview.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">COVIDlabreview</span><span class="signature">(production=False)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">production</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">COVIDlabreview</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">production</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_main_window_handle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_address_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failed_immpact_query_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unambigous_races</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;American Indian or Alaska Native&#39;</span>
                                  <span class="p">,</span><span class="s1">&#39;Asian&#39;</span>
                                  <span class="p">,</span><span class="s1">&#39;Black or African American&#39;</span>
                                  <span class="p">,</span><span class="s1">&#39;Native Hawaiian or Other Pacific Islander&#39;</span>
                                  <span class="p">,</span><span class="s1">&#39;White&#39;</span><span class="p">]</span>
        <span class="c1"># The xpaths are set here because they are required by multiple methods. This creates one maintenance point in the event of future change.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[2]/td[2]/input&#39;</span>
                                      <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[3]/td[2]/input&#39;</span>
                                      <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[4]/td[2]/input&#39;</span>
                                      <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[5]/td[2]/input&#39;</span>
                                      <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[6]/td[2]/input&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[1]/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">street_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;DEM159&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;DEM161&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;DEM163&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">county_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_15&quot;]/tbody/tr[6]/td[2]/input&#39;</span>
</pre></div>

        </details>

            <div class="docstring"><p>Creates a new instance of the chrome driver.
Starts the service and then creates new instance of chrome driver.</p>

<p>:Args:</p>

<ul>
<li>executable_path - Deprecated: path to the executable. If the default is used it assumes the executable is in the $PATH</li>
<li>port - Deprecated: port you would like the service to run, if left as 0, a free port will be found.</li>
<li>options - this takes an instance of ChromeOptions</li>
<li>service - Service object for handling the browser driver if you need to pass extra details</li>
<li>service_args - Deprecated: List of args to pass to the driver service</li>
<li>desired_capabilities - Deprecated: Dictionary object with non-browser specific
capabilities only, such as "proxy" or "loggingPref".</li>
<li>service_log_path - Deprecated: Where to log information from the driver.</li>
<li>keep_alive - Deprecated: Whether to configure ChromeRemoteConnection to use HTTP keep-alive.</li>
</ul>
</div>


                            </div>
                            <div id="COVIDlabreview.reset" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.reset">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">reset</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clear values of attributes assigned during case investigation review.</span>
<span class="sd">        To be used on initialization and between case reviews. &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">now_str</span> <span class="o">=</span> <span class="n">today</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address_complete</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_doses_prior_to_onset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_dose_date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">street</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">county</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_code</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">demo_race</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">demo_ethnicity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">investigation_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_window_handle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiple_possible_patients_in_immpact</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>

        </details>

            <div class="docstring"><p>Clear values of attributes assigned during case investigation review.
To be used on initialization and between case reviews.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.get_db_connection_info" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.get_db_connection_info">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_db_connection_info</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_db_connection_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read information required to connect to the NBS database.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;driver&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;server&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_rdb_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;rdb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_odse_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;odse&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_unassigned_covid_lab_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;unassigned_covid_lab_table&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbs_patient_list_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBSdb&#39;</span><span class="p">,</span> <span class="s1">&#39;patient_list_view&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Read information required to connect to the NBS database.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.get_patient_table" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.get_patient_table">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_patient_table</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_patient_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Execute a view in the nbs_odse database to return all patients in</span>
<span class="sd">        NBS including firt name, last name, birth date, and parent id. This data</span>
<span class="sd">        is then stored in a DataFrame for future use.&quot;&quot;&quot;</span>

        <span class="c1"># Connect to database</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RETRIEVE NBS PATIENT LIST:</span><span class="se">\n</span><span class="s1">Connecting to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_odse_name</span><span class="si">}</span><span class="s1"> database...&#39;</span><span class="p">)</span>
        <span class="n">Connection</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;Driver={&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_driver</span> <span class="o">+</span> <span class="s2">&quot;};&quot;</span>
                              <span class="sa">fr</span><span class="s2">&quot;Server=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_server</span><span class="si">}</span><span class="s2">;&quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;Database=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_odse_name</span><span class="si">}</span><span class="s2">;&quot;</span>
                              <span class="s2">&quot;Trusted_Connection=yes;&quot;</span><span class="p">)</span>
        <span class="c1"># Execute query and close connection</span>
        <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Connected to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_odse_name</span><span class="si">}</span><span class="s1">. Executing query...&#39;</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT PERSON_PARENT_UID, UPPER(FIRST_NM) AS FIRST_NM, UPPER(LAST_NM) AS LAST_NM, BIRTH_DT FROM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_patient_list_view</span><span class="si">}</span><span class="s2"> WHERE (FIRST_NM IS NOT NULL) AND (LAST_NM IS NOT NULL) AND (BIRTH_DT IS NOT NULL) AND (RECORD_STATUS_CD = &#39;ACTIVE&#39;)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">Connection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">Connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Data recieved and database connection closed.&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Execute a view in the nbs_odse database to return all patients in
NBS including firt name, last name, birth date, and parent id. This data
is then stored in a DataFrame for future use.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.get_unassigned_covid_labs" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.get_unassigned_covid_labs">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_unassigned_covid_labs</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_unassigned_covid_labs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Connect to the analyis NBS database and execute a query to return a</span>
<span class="sd">        list of all unassociated labs along with the data required to create</span>
<span class="sd">        investigations for them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_counties</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_min_delay</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_age_range</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_aoe_filters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_db_connection_info</span><span class="p">()</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Lab_Local_ID&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;CAST(Lab_Rpt_Received_By_PH_Dt AS DATE) AS Lab_Rpt_Received_By_PH_Dt&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;CAST(Specimen_Coll_DT AS DATE) AS Specimen_Coll_DT&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Perform_Facility_Name&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;UPPER(First_Name) AS First_Name&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;UPPER(Middle_Name) AS Middle_Name&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;UPPER(Last_Name) AS Last_Name&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Patient_Local_ID&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Current_Sex_Cd&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;CAST(Birth_Dt AS DATE) AS Birth_Dt&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Patient_Race_Calc&#39;</span>
                        <span class="p">,</span><span class="s2">&quot;CASE WHEN Patient_Ethnicity = &#39;2186-5&#39; THEN &#39;Hispanic or Latino&#39; &quot;</span>
                        <span class="s2">&quot;WHEN Patient_Ethnicity = &#39;2135-2&#39; THEN &#39;Not Hispanic or Latino&#39; &quot;</span>
                        <span class="s2">&quot;ELSE &#39;Unknown&#39; END AS Patient_Ethnicity&quot;</span>
                        <span class="p">,</span><span class="s1">&#39;Patient_Death_Ind&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Patient_Death_Date&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Phone_Number&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Address_One&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Address_Two&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;City&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;State&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;County_Desc&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Jurisdiction_Nm&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;EMPLOYED_IN_HEALTHCARE&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;HOSPITALIZED&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;PATIENT_AGE&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;PREGNANT&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;RESIDENT_CONGREGATE_SETTING&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;SYMPTOMATIC_FOR_DISEASE&#39;</span>
                        <span class="p">,</span><span class="s2">&quot;CASE WHEN ILLNESS_ONSET_DATE LIKE &#39;[0-9][0-9][/-][0-9][0-9][/-][0-9][0-9][0-9][0-9]&#39; THEN CAST(ILLNESS_ONSET_DATE AS DATE) &quot;</span>
		                <span class="s2">&quot;WHEN ILLNESS_ONSET_DATE LIKE &#39;[0-9][0-9][0-9][0-9][/-][0-9][0-9][/-][0-9][0-9]&#39; THEN CAST(ILLNESS_ONSET_DATE AS DATE) &quot;</span>
		                <span class="s2">&quot;WHEN ILLNESS_ONSET_DATE LIKE &#39;[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]&#39; THEN CAST(ILLNESS_ONSET_DATE AS DATE) &quot;</span>
		                <span class="s2">&quot;ELSE NULL END AS ILLNESS_ONSET_DATE&quot;</span>
                        <span class="p">,</span><span class="s1">&#39;FIRST_RESPONDER&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;TestType&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;DATEDIFF(DAY, CAST(Specimen_Coll_DT AS DATE), GETDATE()) AS review_delay&#39;</span>
                        <span class="p">)</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
        <span class="c1"># If a lab is not positive an investigation should not be created for it.</span>
        <span class="c1"># All cases with AOEs indicating hospitalization, or death should be assigned out for investigation. These cases should not be opened and closed.</span>
        <span class="n">where</span> <span class="o">=</span> <span class="s2">&quot;WHERE (Result_Category = &#39;Positive&#39;) AND (State = &#39;ME&#39;) AND (TestType IN (&#39;PCR&#39;, &#39;Antigen&#39;)) AND (HOSPITALIZED IS NULL OR UPPER(HOSPITALIZED) NOT LIKE &#39;Y%&#39;) AND (ICU IS NULL OR UPPER(ICU) NOT LIKE &#39;Y%&#39;) AND (Patient_Death_Ind IS NULL OR UPPER(Patient_Death_Ind) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; AND (DATEDIFF(DAY, Lab_Rpt_Received_By_PH_Dt ,GETDATE())) &gt;= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; AND (DATEDIFF(DAY, CAST(Birth_Dt AS DATE), CAST(Specimen_Coll_DT AS DATE))/365.25 &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_age</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; AND (DATEDIFF(DAY, CAST(Birth_Dt AS DATE), CAST(Specimen_Coll_DT AS DATE))/365.25 &lt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_age</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cong_aoe_lab</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="s2">&quot; AND (RESIDENT_CONGREGATE_SETTING IS NULL OR UPPER(RESIDENT_CONGREGATE_SETTING) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hcw_aoe_lab</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="s2">&quot; AND (EMPLOYED_IN_HEALTHCARE IS NULL OR UPPER(EMPLOYED_IN_HEALTHCARE) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">responder_aoe_lab</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="s2">&quot; AND (FIRST_RESPONDER IS NULL OR UPPER(FIRST_RESPONDER) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pregnant_aoe_lab</span><span class="p">:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">where</span> <span class="o">+</span> <span class="s2">&quot; AND (PREGNANT IS NULL OR UPPER(PREGNANT) NOT LIKE &#39;Y%&#39;)&quot;</span>
        <span class="n">order_by</span> <span class="o">=</span> <span class="s1">&#39;ORDER BY Lab_Rpt_Received_By_PH_Dt&#39;</span>
        <span class="c1"># Construct Query</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;SELECT&#39;</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="s1">&#39;FROM&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbs_unassigned_covid_lab_table</span><span class="p">,</span> <span class="n">where</span><span class="p">,</span> <span class="n">order_by</span><span class="p">]</span> <span class="p">)</span>
        <span class="c1"># Connect to database</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RETRIEVE UNASSOCIATED LAB LIST:</span><span class="se">\n</span><span class="s1">Connecting to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_rdb_name</span><span class="si">}</span><span class="s1"> database...&#39;</span><span class="p">)</span>
        <span class="n">Connection</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;Driver={&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_driver</span> <span class="o">+</span> <span class="s2">&quot;};&quot;</span>
                              <span class="sa">fr</span><span class="s2">&quot;Server=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_db_server</span><span class="si">}</span><span class="s2">;&quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;Database=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_rdb_name</span><span class="si">}</span><span class="s2">;&quot;</span>
                              <span class="s2">&quot;Trusted_Connection=yes;&quot;</span><span class="p">)</span>
        <span class="c1"># Execute query and close connection</span>
        <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Connected to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbs_rdb_name</span><span class="si">}</span><span class="s1">. Executing query...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">Connection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">County_Desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">County_Desc</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; County&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">Connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">Jurisdiction_Nm</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">Patient_Local_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unassociated_labs</span><span class="o">.</span><span class="n">Patient_Local_ID</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clean_patient_id</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Data recieved and database connection closed.&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Connect to the analyis NBS database and execute a query to return a
list of all unassociated labs along with the data required to create
investigations for them.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.select_counties" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.select_counties">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">select_counties</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">select_counties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A method to prompt the user to specify which counties unassociated labs should be review from.&quot;&quot;&quot;</span>
        <span class="n">maine_counties</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Androscoggin&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Aroostook&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Cumberland&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Franklin&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Hancock&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Kennebec&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Knox&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Lincoln&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Oxford&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Penobscot&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Piscataquis&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Sagadahoc&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Somerset&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Waldo&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Washington&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;York&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">county</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">maine_counties</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">county</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counties</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;COUNTY SLECTION:</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Choose the counties from which to review unassocated labs.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Make your selection by entering the row numbers of the desired counties separated by commas.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;For example, to select Cumberland and York counties enter &quot;2,15&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Press enter to skip this step and review unassociated labs from all counties.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">counties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">counties</span> <span class="o">=</span> <span class="p">[</span><span class="n">maine_counties</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">county</span><span class="p">)]</span><span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>A method to prompt the user to specify which counties unassociated labs should be review from.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.select_min_delay" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.select_min_delay">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">select_min_delay</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">select_min_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A method to prompt the user to specify the minimum delay in reviewing unassociated labs.</span>
<span class="sd">        If 3 is select then NBSbot will only review unassocated labs that were reported 3 or more days ago.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET MINIMUM REVIEW DELAY:</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Enter the minimum integer number of days between the date a lab was collected and today that unassociated labs should be reviewed from.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;Enter &quot;0&quot; or simply press enter to skip this step and review all unassociated labs regardless of review delay.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_delay</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>A method to prompt the user to specify the minimum delay in reviewing unassociated labs.
If 3 is select then NBSbot will only review unassocated labs that were reported 3 or more days ago.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.get_age_range" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.get_age_range">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_age_range</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_age_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prompt user to provide the minimum and maximum patient age of unassociated labs to be opened and closed.&quot;&quot;&quot;</span>
        <span class="n">default_min</span> <span class="o">=</span> <span class="s1">&#39;-5&#39;</span>
        <span class="n">default_max</span> <span class="o">=</span> <span class="s1">&#39;150&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_age</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET MINIMUM AGE:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;Enter the minimum age in years that cases should be opened and closed for.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;If no age is specified the minimum value will be set to </span><span class="si">{</span><span class="n">default_min</span><span class="si">}</span><span class="s1"> years.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_age</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET MAXIMUM AGE:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;Enter the maximum age in years that cases should be opened and closed for.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;If no age is specified the maximum value will be set to </span><span class="si">{</span><span class="n">default_max</span><span class="si">}</span><span class="s1"> years.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_age</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_age</span> <span class="o">=</span> <span class="n">default_min</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_age</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_age</span> <span class="o">=</span> <span class="n">default_max</span>
</pre></div>

        </details>

            <div class="docstring"><p>Prompt user to provide the minimum and maximum patient age of unassociated labs to be opened and closed.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.select_aoe_filters" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.select_aoe_filters">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">select_aoe_filters</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">select_aoe_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prompt user to decide if they would like to filter out unassociated las on the basis of affirmative AOE respones.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cong_aoe_lab</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET CONGREGATE AOE FILTER:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;0: Review unassociated labs with an affirmative congregate setting AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;1: DO NOT review unassociated labs with an affirmative congregate setting AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;To review labs with an affirmative congregte setting AOE response enter &quot;0&quot; or simply press enter.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;If you would NOT like to review unasocciated labs with an affiramtive congregate setting AOE enter &quot;1&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hcw_aoe_lab</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET HEALTHCARE WORKER AOE FILTER:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;0: Review unassociated labs with an affirmative heathcare worker AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;1: DO NOT review unassociated labs with an affirmative healthcare worker AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;To review labs with an affirmative healthcare worker AOE response enter &quot;0&quot; or simply press enter.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;If you would NOT like to review unasocciated labs with an affiramtive healthcare worker AOE enter &quot;1&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">responder_aoe_lab</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET FIRST RESPONDER AOE FILTER:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;0: Review unassociated labs with an affirmative first responder AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;1: DO NOT review unassociated labs with an affirmative frist responder AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;To review labs with an affirmative first responder AOE response enter &quot;0&quot; or simply press enter.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;If you would NOT like to review unasocciated labs with an affiramtive first responder AOE enter &quot;1&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pregnant_aoe_lab</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">SET PREGNANT AOE FILTER:</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;0: Review unassociated labs with an affirmative congregate setting AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;1: DO NOT  Review unassociated labs with an affirmative congregate setting AOE response.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;To review labs with an affirmative congregte setting AOE response enter &quot;0&quot; or simply press enter.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;If you would NOT like to review unasocciated labs with an affiramtive congregate setting AOE enter &quot;1&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Prompt user to decide if they would like to filter out unassociated las on the basis of affirmative AOE respones.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.check_for_possible_merges" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.check_for_possible_merges">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">check_for_possible_merges</span><span class="signature">(self, fname, lname, dob)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">check_for_possible_merges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">lname</span><span class="p">,</span> <span class="n">dob</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Given a patient&#39;s first name, last name, and dob search for possible</span>
<span class="sd">        matches amoung all patients in NBS.&quot;&quot;&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">FIRST_NM</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">fname</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">LAST_NM</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">lname</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_list</span><span class="o">.</span><span class="n">BIRTH_DT</span> <span class="o">==</span> <span class="n">dob</span><span class="p">)]</span>
        <span class="n">unique_profiles</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">PERSON_PARENT_UID</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_profiles</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">possible_merges</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">possible_merges</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">possible_merges</span>
</pre></div>

        </details>

            <div class="docstring"><p>Given a patient's first name, last name, and dob search for possible
matches amoung all patients in NBS.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.check_patient_hospitalization_status" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.check_patient_hospitalization_status">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">check_patient_hospitalization_status</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">check_patient_hospitalization_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check Patient Status at Specimen Collection from inside a lab report.</span>
<span class="sd">        Occasionally there are cases that indicate a status of &#39;inpatient&#39; without an AOE inidicating a hospitalization.</span>
<span class="sd">        In this case the bot will not open and closed a case, but instead leave the lab for human review.&quot;&quot;&quot;</span>
        <span class="n">patient_status_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_LAB330&quot;]&#39;</span>
        <span class="n">patient_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">patient_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">patient_status</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;HOSPITALIZED&#39;</span><span class="p">,</span> <span class="s1">&#39;INPATIENT&#39;</span><span class="p">]:</span>
            <span class="n">possible_hospitalization</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">possible_hospitalization</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">possible_hospitalization</span>
</pre></div>

        </details>

            <div class="docstring"><p>Check Patient Status at Specimen Collection from inside a lab report.
Occasionally there are cases that indicate a status of 'inpatient' without an AOE inidicating a hospitalization.
In this case the bot will not open and closed a case, but instead leave the lab for human review.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.check_for_existing_investigation" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.check_for_existing_investigation">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">check_for_existing_investigation</span><span class="signature">(self, collection_date)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">check_for_existing_investigation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Review the Investigations table in the Events tab of a patient profile</span>
<span class="sd">        to determine if the case already has an existing investigation. &quot;&quot;&quot;</span>
        <span class="n">investigation_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_investigation_table</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">investigation_table</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">investigation_table</span><span class="p">[</span><span class="s1">&#39;days_prior&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">investigation_table</span><span class="p">[</span><span class="s1">&#39;Start Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">collection_date</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">date</span><span class="p">())</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
            <span class="n">existing_investigations</span> <span class="o">=</span> <span class="n">investigation_table</span><span class="p">[(</span><span class="n">investigation_table</span><span class="o">.</span><span class="n">days_prior</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">)</span>
                                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">investigation_table</span><span class="o">.</span><span class="n">days_prior</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">35</span><span class="p">)</span>
                                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">investigation_table</span><span class="o">.</span><span class="n">Condition</span> <span class="o">==</span> <span class="s1">&#39;2019 Novel Coronavirus (2019-nCoV)&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_investigations</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span> <span class="o">=</span> <span class="n">existing_investigations</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">inv_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_investigations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">existing_investigations</span><span class="p">[</span><span class="s1">&#39;Case Status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Not a Case&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">existing_not_a_case</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">existing_not_a_case</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">existing_investigation_index</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">inv_found</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">existing_not_a_case</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inv_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">existing_not_a_case</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">inv_found</span><span class="p">,</span> <span class="n">existing_not_a_case</span>
</pre></div>

        </details>

            <div class="docstring"><p>Review the Investigations table in the Events tab of a patient profile
to determine if the case already has an existing investigation.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.create_investigation" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.create_investigation">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">create_investigation</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">create_investigation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new investigation from within a lab report when one does not already exist .&quot;&quot;&quot;</span>
        <span class="n">create_investigation_button_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;doc3&quot;]/div[2]/table/tbody/tr/td[2]/input[1]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">create_investigation_button_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">create_investigation_button_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">select_condition_field_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ccd_ac_table&quot;]/tbody/tr[1]/td/input&#39;</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="s1">&#39;2019 Novel Coronavirus (2019-nCoV)&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">select_condition_field_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">select_condition_field_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
        <span class="n">submit_button_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/table/tbody/tr/td/table/tbody/tr[3]/td/table/thead/tr[2]/td/div/table/tbody/tr/td/table/tbody/tr/td[4]/table[1]/tbody/tr[1]/td/input&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_button_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_button_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Create a new investigation from within a lab report when one does not already exist .</p>
</div>


                            </div>
                            <div id="COVIDlabreview.associate_lab_with_investigation" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.associate_lab_with_investigation">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">associate_lab_with_investigation</span><span class="signature">(self, lab_id)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">associate_lab_with_investigation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Associate a lab with an existing investigation when one for the case has already been started.&quot;&quot;&quot;</span>
        <span class="n">lab_report_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;events1&quot;]&#39;</span>
        <span class="n">lab_report_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">lab_report_table_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lab_report_table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lab_row_index</span> <span class="o">=</span> <span class="n">lab_report_table</span><span class="p">[</span><span class="n">lab_report_table</span><span class="p">[</span><span class="s1">&#39;Event ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">lab_id</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lab_row_index</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lab_row_index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">lab_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/html/body/div[2]/div/form/div/div/div/table[2]/tbody/tr/td/table/tbody/tr[</span><span class="si">{</span><span class="n">lab_row_index</span><span class="si">}</span><span class="s1">]/td[1]/div/input&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">lab_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span><span class="n">lab_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Associate a lab with an existing investigation when one for the case has already been started.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.query_immpact" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.query_immpact">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">query_immpact</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">query_immpact</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Click the query registry button, submit the query to immpact, and read the results into a DataFrame.&quot;&quot;&quot;</span>
        <span class="n">query_registry_button</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;events3&quot;]/tbody/tr/td/div/input[1]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">query_registry_button</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">query_registry_button</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
        <span class="n">submit_query</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;doc4&quot;]/div[2]/input[1]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_query</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
        <span class="n">results_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;section1&quot;]/div/table&#39;</span>
        <span class="n">results_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">results_table_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results_table</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">results_table</span><span class="p">[</span><span class="s1">&#39;Patient Name&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Nothing found to display.&#39;</span><span class="p">):</span>
            <span class="n">record_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;parent&quot;]/tbody/tr/td[1]/a&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">record_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
            <span class="n">vax_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;section1&quot;]/div/table[2]&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">vax_table_path</span><span class="p">)</span>
            <span class="n">good_query</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">good_query</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Immpact returned more than one patient as a possible, or found no matching patients. Unable to proceed with the automated query.&#39;</span><span class="p">)</span>
            <span class="n">cancel_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/form/div[2]/div/div[1]/input&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">cancel_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">alert</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results_table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multiple_possible_patients_in_immpact</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">good_query</span>
</pre></div>

        </details>

            <div class="docstring"><p>Click the query registry button, submit the query to immpact, and read the results into a DataFrame.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.id_covid_vaccinations" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.id_covid_vaccinations">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">id_covid_vaccinations</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">id_covid_vaccinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Identify COVID vaccines by their specific brand.&quot;&quot;&quot;</span>
        <span class="n">covid_vax_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pfizer&#39;</span><span class="p">:</span><span class="s1">&#39;COVID-19, mRNA, LNP-S, PF, 30 mcg/0.3 mL dose&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Moderna&#39;</span><span class="p">:</span><span class="s1">&#39;COVID-19, mRNA, LNP-S, PF, 100 mcg/ 0.5 mL dose&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;JJ&#39;</span><span class="p">:</span><span class="s1">&#39;COVID-19 vaccine, vector-nr, rS-Ad26, PF, 0.5 mL&#39;</span>
                        <span class="p">,</span><span class="s1">&#39;Pfizer_5to12&#39;</span><span class="p">:</span> <span class="s1">&#39;Tris-sucrose formula, 10 mcg/0.2 mL for ages 5 yrs to &lt; 12 yrs&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">covid_vax_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="p">[</span><span class="s1">&#39;Vaccine Administered&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">covid_vax_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">Pfizer</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">Moderna</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">JJ</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="o">.</span><span class="n">Pfizer_5to12</span><span class="p">]</span>
        <span class="c1">#self.covid_vaccinations[&#39;Date Administered&#39;] = pd.to_datetime(self.covid_vaccinations[&#39;Date Administered&#39;])</span>
        <span class="c1">#self.covid_vaccinations[&#39;Date Administered&#39;] = self.covid_vaccinations[&#39;Date Administered&#39;].dt.date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">(),</span> <span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>
</pre></div>

        </details>

            <div class="docstring"><p>Identify COVID vaccines by their specific brand.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.import_covid_vaccinations" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.import_covid_vaccinations">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">import_covid_vaccinations</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">import_covid_vaccinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Select all COVID vaccinations in the list returned by Immpact and import them.&quot;&quot;&quot;</span>
        <span class="n">covid_vax_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">num_covid_vaccinations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">covid_vax_indexes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_covid_vaccinations</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vax_table</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">covid_vax_indexes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">select_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/form/div[2]/div/div[4]/div/table[2]/tbody/tr/td/table/tbody/tr/td[1]/input&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">select_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">covid_vax_indexes</span><span class="p">:</span>
                    <span class="n">select_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/html/body/form/div[2]/div/div[4]/div/table[2]/tbody/tr/td/table/tbody/tr[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">]/td[1]/input&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">select_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="n">import_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/form/div[2]/div/div[1]/input[1]&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">import_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">alert</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_handles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_handles</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">handle</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window_handle</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window_handle</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">failed_immpact_query_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cancel_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/form/div[2]/div/div[1]/input[2]&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">cancel_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">alert</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Select all COVID vaccinations in the list returned by Immpact and import them.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.determine_vaccination_status" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.determine_vaccination_status">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">determine_vaccination_status</span><span class="signature">(self, collection_date)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">determine_vaccination_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Determine vaccination status at time of illness and other required vaccination data points.&quot;&quot;&quot;</span>
        <span class="n">covid_vaccinations_prior_to_onset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">collection_date</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_doses_prior_to_onset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">covid_vaccinations_prior_to_onset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_dose_date</span> <span class="o">=</span> <span class="n">covid_vaccinations_prior_to_onset</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">complete_vaccinations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">[</span><span class="s1">&#39;Date Administered&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">collection_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">))]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">Pfizer</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">Moderna</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">JJ</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">complete_vaccinations</span><span class="o">.</span><span class="n">Pfizer_5to12</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_vaccinated</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>

        </details>

            <div class="docstring"><p>Determine vaccination status at time of illness and other required vaccination data points.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.read_street" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.read_street">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">read_street</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">read_street</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read the current street address.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">street</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">street_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Read the current street address.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.read_city" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.read_city">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">read_city</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">read_city</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the current city/town.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Read the current city/town.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.read_zip" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.read_zip">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">read_zip</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">read_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the current zip code. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zip_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Read the current zip code.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.write_zip" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.write_zip">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">write_zip</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">write_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write zip code. Intended for use after looking up a missing zip code with zip_code_lookup().&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zip_code</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Write zip code. Intended for use after looking up a missing zip code with zip_code_lookup().</p>
</div>


                            </div>
                            <div id="COVIDlabreview.read_county" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.read_county">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">read_county</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">read_county</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the current county. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">county</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">county_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Read the current county.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.write_county" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.write_county">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">write_county</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">write_county</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write county. Intended for use after looking up a missing missing count with county_lookup().&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">county_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">county</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Write county. Intended for use after looking up a missing missing count with county_lookup().</p>
</div>


                            </div>
                            <div id="COVIDlabreview.read_address" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.read_address">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">read_address</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">read_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read parts of the patient address except for state and country.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_street</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_city</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_zip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_county</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Read parts of the patient address except for state and country.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_state" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_state">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_state</span><span class="signature">(self, state)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set state value in patient address.&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_15&quot;]/tbody/tr[4]/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Set state value in patient address.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_country" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_country">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_country</span><span class="signature">(self, country)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_country</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">country</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set country value in patient address.&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_15&quot;]/tbody/tr[7]/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">country</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Set country value in patient address.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.check_ethnicity" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.check_ethnicity">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">check_ethnicity</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">check_ethnicity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if ethnicity is completed and if not set the values to unknown.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Check if ethnicity is completed and if not set the values to unknown.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.clear_ambiguous_race_answers" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.clear_ambiguous_race_answers">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">clear_ambiguous_race_answers</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">clear_ambiguous_race_answers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Ensure all ambiguous race answers (refused to answer, not answered, and unknown) are not selected.&quot;&quot;&quot;</span>
        <span class="n">ambiguous_answer_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[8]/td[2]/input&#39;</span>
                                 <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[9]/td[2]/input&#39;</span>
                                 <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[10]/td[2]/input&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">ambiguous_answer_paths</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unselect_checkbox</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Ensure all ambiguous race answers (refused to answer, not answered, and unknown) are not selected.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.check_race" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.check_race">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">check_race</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">check_race</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Review current race value. If any combination of non-ambiguous options</span>
<span class="sd">        are selection make sure all other choice are not selected. Accept &quot;other&quot;</span>
<span class="sd">        only when no unambigious answer is present. When race is not clearly</span>
<span class="sd">        defined or other set value to unknown.&quot;&quot;&quot;</span>
        <span class="n">other_race_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[7]/td[2]/input&#39;</span>
        <span class="n">unknown_race_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_9&quot;]/tbody/tr[10]/td[2]/input&#39;</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race_paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">is_selected</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_ambiguous_race_answers</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unselect_checkbox</span><span class="p">(</span><span class="n">other_race_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">other_race_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_selected</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_checkbox</span><span class="p">(</span><span class="n">other_race_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">unknown_race_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Review current race value. If any combination of non-ambiguous options
are selection make sure all other choice are not selected. Accept "other"
only when no unambigious answer is present. When race is not clearly
defined or other set value to unknown.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.read_demographic_address" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.read_demographic_address">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">read_demographic_address</span><span class="signature">(self, state=&#39;&#39;)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">read_demographic_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read address table from the demographics tab of a patient profile and</span>
<span class="sd">        select the most recent address from within the last year that is consistent</span>
<span class="sd">        with all parts of the address reported in the current lab report.&quot;&quot;&quot;</span>
        <span class="n">address_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;patSearch8&quot;]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">address_table_path</span><span class="p">)))</span>
        <span class="n">address_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">address_table_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">address_table</span><span class="p">)</span> <span class="o">!=</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">address_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">address_table_path</span><span class="p">)</span>
        <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="p">[</span><span class="n">address_table</span><span class="p">[</span><span class="s1">&#39;As of&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="n">address_table</span><span class="p">[</span><span class="s1">&#39;As of&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">address_table</span><span class="p">[</span><span class="s1">&#39;As of&#39;</span><span class="p">],</span> <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y&quot;</span><span class="p">)</span>
        <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="p">[</span><span class="s1">&#39;As of&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">))]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">address_table</span><span class="o">.</span><span class="n">Zip</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">Zip</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="k">else</span> <span class="n">x</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">street</span><span class="p">:</span>
            <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="o">.</span><span class="n">Address</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">street</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="p">:</span>
            <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="o">.</span><span class="n">City</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
        <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="o">.</span><span class="n">State</span> <span class="o">==</span> <span class="s1">&#39;Maine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_code</span><span class="p">:</span>
            <span class="n">address_table</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">address_table</span><span class="o">.</span><span class="n">Zip</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">street</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">address_table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span> <span class="o">=</span> <span class="n">address_table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Read address table from the demographics tab of a patient profile and
select the most recent address from within the last year that is consistent
with all parts of the address reported in the current lab report.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.write_demographic_address" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.write_demographic_address">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">write_demographic_address</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">write_demographic_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; After reading an address from the demographics tab, moving back into</span>
<span class="sd">        an investigation, and entering edit mode, write the data to the address</span>
<span class="sd">        fields.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">street_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span><span class="o">.</span><span class="n">Address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">city_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span><span class="o">.</span><span class="n">City</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zip_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span><span class="o">.</span><span class="n">Zip</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">county_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_address</span><span class="o">.</span><span class="n">Address</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>After reading an address from the demographics tab, moving back into
an investigation, and entering edit mode, write the data to the address
fields.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.read_demographic_race" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.read_demographic_race">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">read_demographic_race</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">read_demographic_race</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the race table in the demographics tab and select the most recent</span>
<span class="sd">        nonambigous value, if present.&quot;&quot;&quot;</span>
        <span class="n">race_table_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;patSearch14&quot;]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">race_table_path</span><span class="p">)))</span>
        <span class="n">race_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">race_table_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">race_table</span><span class="p">)</span> <span class="o">!=</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">race_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadTableToDF</span><span class="p">(</span><span class="n">race_table_path</span><span class="p">)</span>
        <span class="n">all_race_values</span> <span class="o">=</span> <span class="n">race_table</span><span class="o">.</span><span class="n">Race</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">unambiguous_race_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_race_values</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unambigous_races</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">unambiguous_race_values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">demo_race</span> <span class="o">=</span> <span class="n">unambiguous_race_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Read the race table in the demographics tab and select the most recent
nonambigous value, if present.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.write_demographic_race" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.write_demographic_race">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">write_demographic_race</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">write_demographic_race</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; After reading a race from the demographics tab, moving back into an</span>
<span class="sd">        investigation, and entering edit mode, write the data to the race field.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">race</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unambigous_races</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unambiguous_race_paths</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">race</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demo_race</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_checkbox</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_ambiguous_race_answers</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>After reading a race from the demographics tab, moving back into an
investigation, and entering edit mode, write the data to the race field.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.read_demographic_ethnicity" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.read_demographic_ethnicity">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">read_demographic_ethnicity</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">read_demographic_ethnicity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the ethnicity table in the demographics tab and select the most</span>
<span class="sd">        recent non-unknown value, if present.&quot;&quot;&quot;</span>
        <span class="n">ethnicity_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS108&quot;]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">ethnicity_path</span><span class="p">)))</span>
        <span class="n">ethnicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">ethnicity_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ethnicity</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Hispanic or Latino&#39;</span><span class="p">,</span> <span class="s1">&#39;Not Hispanic or Latino&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">demo_ethnicity</span> <span class="o">=</span> <span class="n">ethnicty</span>
</pre></div>

        </details>

            <div class="docstring"><p>Read the ethnicity table in the demographics tab and select the most
recent non-unknown value, if present.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.write_demographic_ethnicity" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.write_demographic_ethnicity">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">write_demographic_ethnicity</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">write_demographic_ethnicity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; After reading an ethnicity from the demographics tab, moving back into an</span>
<span class="sd">        investigation, and entering edit mode, write the data to the ethnicity field.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ethnicity_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">demo_ethnicity</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>After reading an ethnicity from the demographics tab, moving back into an
investigation, and entering edit mode, write the data to the ethnicity field.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_investigation_start_date" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_investigation_start_date">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_investigation_start_date</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_investigation_start_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set investigation start date to today.&quot;&quot;&quot;</span>
        <span class="n">start_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV147&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">start_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now_str</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Set investigation start date to today.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_investigation_status_closed" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_investigation_status_closed">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_investigation_status_closed</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_investigation_status_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set investigation status to closed.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">incestigation_status_down_arrow</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_19&quot;]/tbody/tr[4]/td[2]/img&#39;</span>
            <span class="n">closed_option</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV109&quot;]/option[1]&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">incestigation_status_down_arrow</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">closed_option</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_investigation_status_closed</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Set investigation status to closed.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_state_case_id" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_state_case_id">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_state_case_id</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_state_case_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the State Case ID to the NBS patient ID.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">state_case_id_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV173&quot;]&#39;</span>
            <span class="n">patient_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadPatientID</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">state_case_id_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_state_case_id</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Set the State Case ID to the NBS patient ID.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.read_investigation_id" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.read_investigation_id">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">read_investigation_id</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">read_investigation_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; From within an investigation read the investigation id.&quot;&quot;&quot;</span>
        <span class="n">investigation_id_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/div/div/form/div[2]/div[1]/table[3]/tbody/tr[2]/td[1]/span[2]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">investigation_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">investigation_id_path</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>From within an investigation read the investigation id.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_county_and_state_report_dates" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_county_and_state_report_dates">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_county_and_state_report_dates</span><span class="signature">(self, report_to_ph_date)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_county_and_state_report_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_to_ph_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set Earliest Date Reported to County and Earliest Date Reported to</span>
<span class="sd">        State based on Lab_Rpt_Received_By_PH_Dt. This method may be used when</span>
<span class="sd">        creating new investigations or when associating additional labs with an</span>
<span class="sd">        existing investigation. In the case where there is an existing report</span>
<span class="sd">        date in the existing invesitigation it will only be replaced when the</span>
<span class="sd">        provided report date is earlier.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">report_date_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;//*[@id=&quot;INV120&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;//*[@id=&quot;INV121&quot;]&#39;</span><span class="p">]</span>
            <span class="n">report_to_ph_date_str</span> <span class="o">=</span> <span class="n">report_to_ph_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">report_date_paths</span><span class="p">:</span>
                <span class="n">current_report_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadDate</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current_report_date</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">report_to_ph_date</span> <span class="o">&lt;</span> <span class="n">current_report_date</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span> <span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">report_to_ph_date_str</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">report_to_ph_date_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_county_and_state_report_dates</span><span class="p">(</span><span class="n">report_to_ph_date</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Set Earliest Date Reported to County and Earliest Date Reported to
State based on Lab_Rpt_Received_By_PH_Dt. This method may be used when
creating new investigations or when associating additional labs with an
existing investigation. In the case where there is an existing report
date in the existing invesitigation it will only be replaced when the
provided report date is earlier.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.update_report_date" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.update_report_date">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">update_report_date</span><span class="signature">(self, report_to_ph_date)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update_report_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_to_ph_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;When associating a lab with an existing investigation check to see if</span>
<span class="sd">        the new lab was reported prior to the report date currently assigned to</span>
<span class="sd">        the investigation. If so, replace it with the report date of the new lab.</span>
<span class="sd">        If not, do nothing.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">report_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV111&quot;]&#39;</span>
            <span class="n">current_report_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadDate</span><span class="p">(</span><span class="n">report_date_path</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="n">report_to_ph_date_str</span> <span class="o">=</span> <span class="n">report_to_ph_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current_report_date</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">report_to_ph_date</span> <span class="o">&lt;</span> <span class="n">current_report_date</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">report_date_path</span> <span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">report_date_path</span> <span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">report_to_ph_date_str</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">report_to_ph_date</span> <span class="o">=</span> <span class="n">report_to_ph_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">report_date_path</span> <span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">report_to_ph_date_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_report_date</span><span class="p">(</span><span class="n">report_to_ph_date</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>When associating a lab with an existing investigation check to see if
the new lab was reported prior to the report date currently assigned to
the investigation. If so, replace it with the report date of the new lab.
If not, do nothing.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_performing_lab" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_performing_lab">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_performing_lab</span><span class="signature">(self, performing_lab)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_performing_lab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">performing_lab</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set performing laboratory name based on lab report.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">performing_lab</span><span class="p">:</span>
                <span class="n">performing_lab_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME6105&quot;]&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">performing_lab_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">performing_lab</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_performing_lab</span><span class="p">(</span><span class="n">performing_lab</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Set performing laboratory name based on lab report.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_earliest_positive_collection_date" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_earliest_positive_collection_date">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_earliest_positive_collection_date</span><span class="signature">(self, lab_collection_date)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_earliest_positive_collection_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_collection_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read the earliest positive speciment collection date field. If there</span>
<span class="sd">        is a date present and it is prior to the collection of the current lab do</span>
<span class="sd">        nothing. In the event that the field is blank or the collection of the</span>
<span class="sd">        current lab is prior to the current value of the field, set the value to</span>
<span class="sd">        the collection date of the current lab. This additional check allows this</span>
<span class="sd">        method to be used when creating investigations or associating labs with</span>
<span class="sd">        existing investigations.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">collection_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS550&quot;]&#39;</span>
            <span class="n">lab_collection_date_str</span> <span class="o">=</span> <span class="n">lab_collection_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadDate</span><span class="p">(</span><span class="n">collection_date_path</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span> <span class="o">=</span> <span class="n">lab_collection_date</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">collection_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">collection_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">lab_collection_date_str</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lab_collection_date</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span> <span class="o">=</span> <span class="n">lab_collection_date</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">collection_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">collection_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">lab_collection_date_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_earliest_positive_collection_date</span><span class="p">(</span><span class="n">lab_collection_date</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Read the earliest positive speciment collection date field. If there
is a date present and it is prior to the collection of the current lab do
nothing. In the event that the field is blank or the collection of the
current lab is prior to the current value of the field, set the value to
the collection date of the current lab. This additional check allows this
method to be used when creating investigations or associating labs with
existing investigations.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_case_status" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_case_status">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_case_status</span><span class="signature">(self, status)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_case_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set all three fields related to case status based on the provided status.&quot;&quot;&quot;</span>
        <span class="n">current_status_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_GA21015&quot;]/tbody/tr[3]/td[2]/input&#39;</span>
        <span class="n">probable_reason_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_GA21015&quot;]/tbody/tr[4]/td[2]/input&#39;</span>
        <span class="n">case_status_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_2&quot;]/tbody/tr[5]/td[2]/input&#39;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;Confirmed&#39;</span><span class="p">:</span>
            <span class="n">current_status</span> <span class="o">=</span> <span class="s1">&#39;Laboratory-confirmed case&#39;</span>
            <span class="n">probable_reason</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;Probable&#39;</span><span class="p">:</span>
            <span class="n">current_status</span> <span class="o">=</span> <span class="s1">&#39;Probable Case&#39;</span>
            <span class="n">probable_reason</span> <span class="o">=</span> <span class="s1">&#39;Meets Presump Lab and Clinical or Epi&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">current_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">current_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">current_status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">probable_reason_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">probable_reason_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">probable_reason</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">case_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">case_status_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Set all three fields related to case status based on the provided status.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.review_case_status" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.review_case_status">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">review_case_status</span><span class="signature">(self, lab_type)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">review_case_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Review current case status and current lab type. Then set case status</span>
<span class="sd">        accordingly. This method can be used for creating investigations or</span>
<span class="sd">        associating additional labs with existing investigations.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">case_status_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_2&quot;]/tbody/tr[5]/td[2]/input&#39;</span>
            <span class="n">current_case_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">case_status_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lab_type</span> <span class="o">==</span> <span class="s1">&#39;PCR&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_case_status</span><span class="p">(</span><span class="s1">&#39;Confirmed&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lab_type</span> <span class="o">==</span> <span class="s1">&#39;Antigen&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_case_status</span><span class="p">(</span><span class="s1">&#39;Probable&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">review_case_status</span><span class="p">(</span><span class="n">lab_type</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Review current case status and current lab type. Then set case status
accordingly. This method can be used for creating investigations or
associating additional labs with existing investigations.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.update_aoe" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.update_aoe">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">update_aoe</span><span class="signature">(self, aoe_path, lab_aoe)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update_aoe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">,</span> <span class="n">lab_aoe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update a specific AOE associated investigation field by considering</span>
<span class="sd">        its current value and the value in the current lab. An affirmative</span>
<span class="sd">        response in either the investigation or the lab takes precedence, followed</span>
<span class="sd">        by negative, unknown, and null responses respectively.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lab_aoe</span><span class="p">:</span>
                <span class="n">investigation_aoe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">aoe_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;No&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;No&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_aoe</span><span class="p">(</span><span class="n">aoe_path</span><span class="p">,</span> <span class="n">lab_aoe</span><span class="p">,</span> <span class="s1">&#39;case_info&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Update a specific AOE associated investigation field by considering
its current value and the value in the current lab. An affirmative
response in either the investigation or the lab takes precedence, followed
by negative, unknown, and null responses respectively.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.update_case_info_aoes" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.update_case_info_aoes">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">update_case_info_aoes</span><span class="signature">(self, hosp_aoe, cong_aoe, responder_aoe, hcw_aoe)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update_case_info_aoes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hosp_aoe</span><span class="p">,</span> <span class="n">cong_aoe</span><span class="p">,</span> <span class="n">responder_aoe</span><span class="p">,</span> <span class="n">hcw_aoe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update every AOE on the Case Info tabe using the update_aoe() method.&quot;&quot;&quot;</span>
        <span class="n">aoe_dictionary</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;//*[@id=&quot;NBS_UI_NBS_INV_GENV2_UI_3&quot;]/tbody/tr[1]/td[2]/input&#39;</span> <span class="p">:</span> <span class="n">hosp_aoe</span>
                         <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;ME59136&quot;]/tbody/tr[3]/td[2]/input&#39;</span> <span class="p">:</span> <span class="n">cong_aoe</span>
                         <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;ME59137&quot;]/tbody/tr[1]/td[2]/input&#39;</span> <span class="p">:</span> <span class="n">responder_aoe</span>
                         <span class="p">,</span><span class="s1">&#39;//*[@id=&quot;UI_ME59106&quot;]/tbody/tr[1]/td[2]/input&#39;</span> <span class="p">:</span> <span class="n">hcw_aoe</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">aoe_path</span><span class="p">,</span> <span class="n">aoe_value</span> <span class="ow">in</span> <span class="n">aoe_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">aoe_value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_aoe</span><span class="p">(</span><span class="n">aoe_path</span><span class="p">,</span> <span class="n">aoe_value</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Update every AOE on the Case Info tabe using the update_aoe() method.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.update_pregnant_aoe" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.update_pregnant_aoe">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">update_pregnant_aoe</span><span class="signature">(self, pregnant_aoe)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update_pregnant_aoe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pregnant_aoe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update pregnancy status AOE on COVID tab.&quot;&quot;&quot;</span>
        <span class="n">lab_aoe</span> <span class="o">=</span> <span class="n">pregnant_aoe</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lab_aoe</span><span class="p">:</span>
                <span class="n">aoe_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME58100&quot;]/tbody/tr[1]/td[2]/input&#39;</span>
                <span class="n">investigation_aoe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">aoe_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;No&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;No&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_aoe</span> <span class="o">==</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">aoe_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>Update pregnancy status AOE on COVID tab.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.update_symptom_aoe" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.update_symptom_aoe">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">update_symptom_aoe</span><span class="signature">(self, lab_symptom_aoe, lab_onset_date)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">update_symptom_aoe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lab_symptom_aoe</span><span class="p">,</span> <span class="n">lab_onset_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update symptom status based on values in an investigation and values</span>
<span class="sd">        reported in the current lab.&quot;&quot;&quot;</span>
        <span class="n">symptom_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;NBS_UI_GA21003&quot;]/tbody/tr[3]/td[2]/input&#39;</span>
        <span class="n">onset_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV137&quot;]&#39;</span>
        <span class="n">investigation_symptom_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">symptom_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lab_onset_date</span><span class="p">:</span>
            <span class="n">lab_symptom_aoe</span> <span class="o">=</span> <span class="s1">&#39;Yes&#39;</span>
        <span class="k">if</span> <span class="n">lab_symptom_aoe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">symptom_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">investigation_symptom_status</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_symptom_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">symptom_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_symptom_status</span> <span class="o">==</span> <span class="s1">&#39;No&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_symptom_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">symptom_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;No&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">investigation_symptom_status</span> <span class="o">==</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lab_symptom_aoe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">symptom_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">investigation_symptom_status</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">:</span>
                <span class="n">investigation_onset_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadDate</span><span class="p">(</span><span class="n">onsed_date_path</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">investigation_onset_date</span> <span class="ow">and</span> <span class="n">lab_onset_date</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">lab_onset_date</span> <span class="o">&lt;</span> <span class="n">investigation_onset_date</span><span class="p">:</span>
                        <span class="n">lab_onset_date</span> <span class="o">=</span> <span class="n">lab_onset_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">onset_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">onset_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">lab_onset_date</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">lab_onset_date</span><span class="p">:</span>
                    <span class="n">lab_onset_date</span> <span class="o">=</span> <span class="n">lab_onset_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">onset_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">lab_onset_date</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Update symptom status based on values in an investigation and values
reported in the current lab.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_confirmation_date" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_confirmation_date">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_confirmation_date</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_confirmation_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set confirmation date to today when creating a new investigation.&quot;&quot;&quot;</span>
        <span class="n">confirmation_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV162&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">confirmation_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now_str</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Set confirmation date to today when creating a new investigation.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_closed_date" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_closed_date">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_closed_date</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_closed_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set investigation closed date to today when creating a new investigation.&quot;&quot;&quot;</span>
        <span class="n">closed_date_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME11163&quot;]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">closed_date_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now_str</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Set investigation closed date to today when creating a new investigation.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_immpact_query_to_yes" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_immpact_query_to_yes">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_immpact_query_to_yes</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_immpact_query_to_yes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the answer to the &quot;Was ImmPact Queried?&quot; question to yes.&quot;&quot;&quot;</span>
        <span class="n">immpact_query_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME10064101&quot;]/tbody/tr[9]/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">immpact_query_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Set the answer to the "Was ImmPact Queried?" question to yes.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_vaccination_fields" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_vaccination_fields">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_vaccination_fields</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_vaccination_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fill in all vaccination specific fields on the COVID tab after querying</span>
<span class="sd">        Immpact when creating a new investigation.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vaccinated_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME10064101&quot;]/tbody/tr[1]/td[2]/input&#39;</span>
            <span class="n">num_dose_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;VAC140&quot;]&#39;</span>
            <span class="n">last_dose_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;VAC142&quot;]&#39;</span>
            <span class="n">fully_vax_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME10064101&quot;]/tbody/tr[4]/td[2]/input&#39;</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_vaccinations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">vaccinated_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">vaccinated_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">vaccinated_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">TAB</span><span class="p">)</span>
                <span class="n">num_doses</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_doses_prior_to_onset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">num_dose_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">num_doses</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">last_dose_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_dose_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">last_dose_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">last_dose_date</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fully_vaccinated</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">fully_vax_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ElementNotInteractableException</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCOVID</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_vaccination_fields</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Fill in all vaccination specific fields on the COVID tab after querying
Immpact when creating a new investigation.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_lab_testing_performed" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_lab_testing_performed">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_lab_testing_performed</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_lab_testing_performed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the laboratory testing performed question to &#39;Yes&#39; when creating</span>
<span class="sd">        a new investigation.&quot;&quot;&quot;</span>
        <span class="n">lab_testing_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;ME58101&quot;]/tbody/tr/td[2]/input&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">lab_testing_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Set the laboratory testing performed question to 'Yes' when creating
a new investigation.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.set_mmwr" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.set_mmwr">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_mmwr</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_mmwr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the values of the MMWR week and year correctly based on first</span>
<span class="sd">        positive speciment collection date.&quot;&quot;&quot;</span>
        <span class="n">week_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV165&quot;]&#39;</span>
        <span class="n">year_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV166&quot;]&#39;</span>
        <span class="n">mmwr_date</span> <span class="o">=</span> <span class="n">Week</span><span class="o">.</span><span class="n">fromdate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_collection_date</span><span class="p">)</span>
        <span class="n">week</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mmwr_date</span><span class="o">.</span><span class="n">week</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">week</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">week</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">week</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mmwr_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">week_path</span><span class="p">)</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">week_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">week</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">year_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">year_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Set the values of the MMWR week and year correctly based on first
positive speciment collection date.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.check_jurisdiction" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.check_jurisdiction">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">check_jurisdiction</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">check_jurisdiction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; After completing an investigation check if the patient&#39;s county and</span>
<span class="sd">        jurisdiction match. If a county is available that does not match the</span>
<span class="sd">        jurisdication then update the jurisdiction accordingly.&quot;&quot;&quot;</span>
        <span class="n">county_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;DEM165&quot;]&#39;</span>
        <span class="n">jurisdiction_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;INV107&quot;]&#39;</span>
        <span class="n">transfer_ownership_path</span> <span class="o">=</span> <span class="s1">&#39;/html/body/div/div/form/div[2]/div[1]/table[2]/tbody/tr/td[1]/table/tbody/tr/td[3]/input&#39;</span>
        <span class="n">new_jurisdiction_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;subsect_transferOwn&quot;]/tbody/tr[2]/td[2]/input&#39;</span>
        <span class="n">submit_jurisdiction_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;topButtId&quot;]/input[1]&#39;</span>
        <span class="n">county</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">county_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">county</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GoToCaseInfo</span><span class="p">()</span>
            <span class="n">jurisdiction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadText</span><span class="p">(</span><span class="n">jurisdiction_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">jurisdiction</span> <span class="ow">in</span> <span class="n">county</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">transfer_ownership_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">new_jurisdiction_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">CONTROL</span><span class="o">+</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">new_jurisdiction_path</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">county</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_jurisdiction_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window_handle</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>After completing an investigation check if the patient's county and
jurisdiction match. If a county is available that does not match the
jurisdication then update the jurisdiction accordingly.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.create_notification" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.create_notification">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">create_notification</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">create_notification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;After completing a case create notification for it.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span><span class="s1">&#39;//*[@id=&quot;createNoti&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_secondary_window</span><span class="p">()</span>
        <span class="n">submit_button_path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&quot;botcreatenotId&quot;]/input[1]&#39;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_before_timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_button_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">submit_button_path</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window_handle</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>After completing a case create notification for it.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.send_bad_address_email" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.send_bad_address_email">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">send_bad_address_email</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">send_bad_address_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Email the COVID Admin the list of patients with incomplete addresses.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_address_log</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;Hello COVID Admin Team,</span><span class="se">\n\n</span><span class="s1">The following cases have incomplete addresses:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">incomplete_address_log</span><span class="p">:</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="o">+</span> <span class="nb">id</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-NBSbot(COVID open/close) AKA Hoover&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_smtp_email</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_admin_list</span><span class="p">,</span> <span class="s1">&#39;Incomplete Addresses&#39;</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="s1">&#39;incomplete address email&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Incomplete addresse log is empty. No email sent.&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Email the COVID Admin the list of patients with incomplete addresses.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.send_failed_query_email" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.send_failed_query_email">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">send_failed_query_email</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">send_failed_query_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Email the COVID Admin the list of patients where the Immpact query failed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_immpact_query_log</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;Hello COVID Commander,</span><span class="se">\n\n</span><span class="s1">The Immpact query for following cases failed:</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_immpact_query_log</span><span class="p">:</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="o">+</span> <span class="nb">id</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-NBSbot(COVID open/close) AKA Hoover&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_smtp_email</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covid_commander</span><span class="p">,</span> <span class="s1">&#39;Failed Immpact Querries&#39;</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="s1">&#39;failed query email&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed query log is empty. No email sent.&#39;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Email the COVID Admin the list of patients where the Immpact query failed.</p>
</div>


                            </div>
                            <div id="COVIDlabreview.pause_for_database" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#COVIDlabreview.pause_for_database">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">pause_for_database</span><span class="signature">(self)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">pause_for_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; If the time is between midnight and 0200 pause until after 0200.&quot;&quot;&quot;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">stop_time</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span> <span class="o">=</span> <span class="mi">23</span><span class="p">,</span> <span class="n">minute</span> <span class="o">=</span> <span class="mi">55</span><span class="p">,</span> <span class="n">second</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">now</span> <span class="o">&gt;=</span> <span class="n">stop_time</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sleeping untill 02:05...&#39;</span><span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">3300</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_to_home</span><span class="p">()</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">3300</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_to_home</span><span class="p">()</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1200</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">go_to_home</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>If the time is between midnight and 0200 pause until after 0200.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>nbsdriver.NBSdriver</dt>
                                <dd id="COVIDlabreview.get_credentials" class="function">get_credentials</dd>
                <dd id="COVIDlabreview.log_in" class="function">log_in</dd>
                <dd id="COVIDlabreview.go_to_id" class="function">go_to_id</dd>
                <dd id="COVIDlabreview.clean_patient_id" class="function">clean_patient_id</dd>
                <dd id="COVIDlabreview.go_to_summary" class="function">go_to_summary</dd>
                <dd id="COVIDlabreview.go_to_events" class="function">go_to_events</dd>
                <dd id="COVIDlabreview.go_to_demographics" class="function">go_to_demographics</dd>
                <dd id="COVIDlabreview.go_to_home" class="function">go_to_home</dd>
                <dd id="COVIDlabreview.GoToApprovalQueue" class="function">GoToApprovalQueue</dd>
                <dd id="COVIDlabreview.ReturnApprovalQueue" class="function">ReturnApprovalQueue</dd>
                <dd id="COVIDlabreview.SortApprovalQueue" class="function">SortApprovalQueue</dd>
                <dd id="COVIDlabreview.HandleBadQueueReturn" class="function">HandleBadQueueReturn</dd>
                <dd id="COVIDlabreview.CheckFirstCase" class="function">CheckFirstCase</dd>
                <dd id="COVIDlabreview.GoToFirstCaseInApprovalQueue" class="function">GoToFirstCaseInApprovalQueue</dd>
                <dd id="COVIDlabreview.GoToCaseInfo" class="function">GoToCaseInfo</dd>
                <dd id="COVIDlabreview.GoToCOVID" class="function">GoToCOVID</dd>
                <dd id="COVIDlabreview.go_to_lab" class="function">go_to_lab</dd>
                <dd id="COVIDlabreview.read_investigation_table" class="function">read_investigation_table</dd>
                <dd id="COVIDlabreview.go_to_investigation_by_index" class="function">go_to_investigation_by_index</dd>
                <dd id="COVIDlabreview.go_to_investigation_by_id" class="function">go_to_investigation_by_id</dd>
                <dd id="COVIDlabreview.return_to_patient_profile_from_inv" class="function">return_to_patient_profile_from_inv</dd>
                <dd id="COVIDlabreview.return_to_patient_profile_from_lab" class="function">return_to_patient_profile_from_lab</dd>
                <dd id="COVIDlabreview.click_submit" class="function">click_submit</dd>
                <dd id="COVIDlabreview.click_manage_associations_submit" class="function">click_manage_associations_submit</dd>
                <dd id="COVIDlabreview.enter_edit_mode" class="function">enter_edit_mode</dd>
                <dd id="COVIDlabreview.click_cancel" class="function">click_cancel</dd>
                <dd id="COVIDlabreview.go_to_manage_associations" class="function">go_to_manage_associations</dd>
                <dd id="COVIDlabreview.CheckForValue" class="function">CheckForValue</dd>
                <dd id="COVIDlabreview.check_for_value_bool" class="function">check_for_value_bool</dd>
                <dd id="COVIDlabreview.ReadDate" class="function">ReadDate</dd>
                <dd id="COVIDlabreview.CheckIfField" class="function">CheckIfField</dd>
                <dd id="COVIDlabreview.ReadText" class="function">ReadText</dd>
                <dd id="COVIDlabreview.ReadTableToDF" class="function">ReadTableToDF</dd>
                <dd id="COVIDlabreview.ReadPatientID" class="function">ReadPatientID</dd>
                <dd id="COVIDlabreview.Sleep" class="function">Sleep</dd>
                <dd id="COVIDlabreview.send_email_local_outlook_client" class="function">send_email_local_outlook_client</dd>
                <dd id="COVIDlabreview.clear_gen_py" class="function">clear_gen_py</dd>
                <dd id="COVIDlabreview.read_config" class="function">read_config</dd>
                <dd id="COVIDlabreview.get_email_info" class="function">get_email_info</dd>
                <dd id="COVIDlabreview.get_usps_user_id" class="function">get_usps_user_id</dd>
                <dd id="COVIDlabreview.send_smtp_email" class="function">send_smtp_email</dd>
                <dd id="COVIDlabreview.get_main_window_handle" class="function">get_main_window_handle</dd>
                <dd id="COVIDlabreview.switch_to_secondary_window" class="function">switch_to_secondary_window</dd>
                <dd id="COVIDlabreview.select_checkbox" class="function">select_checkbox</dd>
                <dd id="COVIDlabreview.unselect_checkbox" class="function">unselect_checkbox</dd>
                <dd id="COVIDlabreview.county_lookup" class="function">county_lookup</dd>
                <dd id="COVIDlabreview.zip_code_lookup" class="function">zip_code_lookup</dd>
                <dd id="COVIDlabreview.check_for_error_page" class="function">check_for_error_page</dd>
                <dd id="COVIDlabreview.go_to_home_from_error_page" class="function">go_to_home_from_error_page</dd>

            </div>
            <div><dt>selenium.webdriver.chromium.webdriver.ChromiumDriver</dt>
                                <dd id="COVIDlabreview.launch_app" class="function">launch_app</dd>
                <dd id="COVIDlabreview.get_network_conditions" class="function">get_network_conditions</dd>
                <dd id="COVIDlabreview.set_network_conditions" class="function">set_network_conditions</dd>
                <dd id="COVIDlabreview.delete_network_conditions" class="function">delete_network_conditions</dd>
                <dd id="COVIDlabreview.set_permissions" class="function">set_permissions</dd>
                <dd id="COVIDlabreview.execute_cdp_cmd" class="function">execute_cdp_cmd</dd>
                <dd id="COVIDlabreview.get_sinks" class="function">get_sinks</dd>
                <dd id="COVIDlabreview.get_issue_message" class="function">get_issue_message</dd>
                <dd id="COVIDlabreview.set_sink_to_use" class="function">set_sink_to_use</dd>
                <dd id="COVIDlabreview.start_tab_mirroring" class="function">start_tab_mirroring</dd>
                <dd id="COVIDlabreview.stop_casting" class="function">stop_casting</dd>
                <dd id="COVIDlabreview.quit" class="function">quit</dd>
                <dd id="COVIDlabreview.create_options" class="function">create_options</dd>

            </div>
            <div><dt>selenium.webdriver.remote.webdriver.WebDriver</dt>
                                <dd id="COVIDlabreview.file_detector" class="variable">file_detector</dd>
                <dd id="COVIDlabreview.file_detector_context" class="function">file_detector_context</dd>
                <dd id="COVIDlabreview.mobile" class="variable">mobile</dd>
                <dd id="COVIDlabreview.name" class="variable">name</dd>
                <dd id="COVIDlabreview.start_client" class="function">start_client</dd>
                <dd id="COVIDlabreview.stop_client" class="function">stop_client</dd>
                <dd id="COVIDlabreview.start_session" class="function">start_session</dd>
                <dd id="COVIDlabreview.create_web_element" class="function">create_web_element</dd>
                <dd id="COVIDlabreview.execute" class="function">execute</dd>
                <dd id="COVIDlabreview.get" class="function">get</dd>
                <dd id="COVIDlabreview.title" class="variable">title</dd>
                <dd id="COVIDlabreview.find_element_by_id" class="function">find_element_by_id</dd>
                <dd id="COVIDlabreview.find_elements_by_id" class="function">find_elements_by_id</dd>
                <dd id="COVIDlabreview.find_element_by_xpath" class="function">find_element_by_xpath</dd>
                <dd id="COVIDlabreview.find_elements_by_xpath" class="function">find_elements_by_xpath</dd>
                <dd id="COVIDlabreview.find_element_by_link_text" class="function">find_element_by_link_text</dd>
                <dd id="COVIDlabreview.find_elements_by_link_text" class="function">find_elements_by_link_text</dd>
                <dd id="COVIDlabreview.find_element_by_partial_link_text" class="function">find_element_by_partial_link_text</dd>
                <dd id="COVIDlabreview.find_elements_by_partial_link_text" class="function">find_elements_by_partial_link_text</dd>
                <dd id="COVIDlabreview.find_element_by_name" class="function">find_element_by_name</dd>
                <dd id="COVIDlabreview.find_elements_by_name" class="function">find_elements_by_name</dd>
                <dd id="COVIDlabreview.find_element_by_tag_name" class="function">find_element_by_tag_name</dd>
                <dd id="COVIDlabreview.find_elements_by_tag_name" class="function">find_elements_by_tag_name</dd>
                <dd id="COVIDlabreview.find_element_by_class_name" class="function">find_element_by_class_name</dd>
                <dd id="COVIDlabreview.find_elements_by_class_name" class="function">find_elements_by_class_name</dd>
                <dd id="COVIDlabreview.find_element_by_css_selector" class="function">find_element_by_css_selector</dd>
                <dd id="COVIDlabreview.find_elements_by_css_selector" class="function">find_elements_by_css_selector</dd>
                <dd id="COVIDlabreview.pin_script" class="function">pin_script</dd>
                <dd id="COVIDlabreview.unpin" class="function">unpin</dd>
                <dd id="COVIDlabreview.get_pinned_scripts" class="function">get_pinned_scripts</dd>
                <dd id="COVIDlabreview.execute_script" class="function">execute_script</dd>
                <dd id="COVIDlabreview.execute_async_script" class="function">execute_async_script</dd>
                <dd id="COVIDlabreview.current_url" class="variable">current_url</dd>
                <dd id="COVIDlabreview.page_source" class="variable">page_source</dd>
                <dd id="COVIDlabreview.close" class="function">close</dd>
                <dd id="COVIDlabreview.current_window_handle" class="variable">current_window_handle</dd>
                <dd id="COVIDlabreview.window_handles" class="variable">window_handles</dd>
                <dd id="COVIDlabreview.maximize_window" class="function">maximize_window</dd>
                <dd id="COVIDlabreview.fullscreen_window" class="function">fullscreen_window</dd>
                <dd id="COVIDlabreview.minimize_window" class="function">minimize_window</dd>
                <dd id="COVIDlabreview.print_page" class="function">print_page</dd>
                <dd id="COVIDlabreview.switch_to" class="variable">switch_to</dd>
                <dd id="COVIDlabreview.back" class="function">back</dd>
                <dd id="COVIDlabreview.forward" class="function">forward</dd>
                <dd id="COVIDlabreview.refresh" class="function">refresh</dd>
                <dd id="COVIDlabreview.get_cookies" class="function">get_cookies</dd>
                <dd id="COVIDlabreview.get_cookie" class="function">get_cookie</dd>
                <dd id="COVIDlabreview.delete_cookie" class="function">delete_cookie</dd>
                <dd id="COVIDlabreview.delete_all_cookies" class="function">delete_all_cookies</dd>
                <dd id="COVIDlabreview.add_cookie" class="function">add_cookie</dd>
                <dd id="COVIDlabreview.implicitly_wait" class="function">implicitly_wait</dd>
                <dd id="COVIDlabreview.set_script_timeout" class="function">set_script_timeout</dd>
                <dd id="COVIDlabreview.set_page_load_timeout" class="function">set_page_load_timeout</dd>
                <dd id="COVIDlabreview.timeouts" class="variable">timeouts</dd>
                <dd id="COVIDlabreview.find_element" class="function">find_element</dd>
                <dd id="COVIDlabreview.find_elements" class="function">find_elements</dd>
                <dd id="COVIDlabreview.desired_capabilities" class="variable">desired_capabilities</dd>
                <dd id="COVIDlabreview.capabilities" class="variable">capabilities</dd>
                <dd id="COVIDlabreview.get_screenshot_as_file" class="function">get_screenshot_as_file</dd>
                <dd id="COVIDlabreview.save_screenshot" class="function">save_screenshot</dd>
                <dd id="COVIDlabreview.get_screenshot_as_png" class="function">get_screenshot_as_png</dd>
                <dd id="COVIDlabreview.get_screenshot_as_base64" class="function">get_screenshot_as_base64</dd>
                <dd id="COVIDlabreview.set_window_size" class="function">set_window_size</dd>
                <dd id="COVIDlabreview.get_window_size" class="function">get_window_size</dd>
                <dd id="COVIDlabreview.set_window_position" class="function">set_window_position</dd>
                <dd id="COVIDlabreview.get_window_position" class="function">get_window_position</dd>
                <dd id="COVIDlabreview.get_window_rect" class="function">get_window_rect</dd>
                <dd id="COVIDlabreview.set_window_rect" class="function">set_window_rect</dd>
                <dd id="COVIDlabreview.orientation" class="variable">orientation</dd>
                <dd id="COVIDlabreview.application_cache" class="variable">application_cache</dd>
                <dd id="COVIDlabreview.log_types" class="variable">log_types</dd>
                <dd id="COVIDlabreview.get_log" class="function">get_log</dd>
                <dd id="COVIDlabreview.bidi_connection" class="function">bidi_connection</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>